import{_ as s,o as n,c as a,d as p}from"./app.46024d5b.js";const i=JSON.parse('{"title":"差值计算图像变化","description":"","frontmatter":{},"headers":[],"relativePath":"blogs/08.图像处理/变化检测-差值算法.md"}'),l={name:"blogs/08.图像处理/变化检测-差值算法.md"},o=p(`<h1 id="差值计算图像变化" tabindex="-1">差值计算图像变化 <a class="header-anchor" href="#差值计算图像变化" aria-hidden="true">#</a></h1><div class="language-py"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki has-diff"><code><span class="line"></span>
<span class="line"><span style="color:#676E95;">#coding:utf-8</span></span>
<span class="line"><span style="color:#676E95;"># 参考《python地理空间分析指南》</span></span>
<span class="line"><span style="color:#676E95;">#插值算法</span></span>
<span class="line"><span style="color:#676E95;">#执行变化监测的步骤大致为:用gdal_array将图片导入numpy数据中——变化前后影像作差——图像分类着色——保存图片。具体的代码为</span></span>
<span class="line"><span style="color:#676E95;">#实验结果中，绿色表示添加的元素，红色表示减少的元素。示例中采用的差值算法的处理结果虽然不够完美，但也能提供一种变化检测的处理思路。最终的实验结果为:</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> numpy </span><span style="color:#89DDFF;">as</span><span style="color:#A6ACCD;"> np</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> matplotlib</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">pyplot</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">as</span><span style="color:#A6ACCD;"> plt</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> osgeo </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> gdal</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> gdal_array</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> cv2</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> sys</span></span>
<span class="line"><span style="color:#676E95;"># 加载两幅图像</span></span>
<span class="line"><span style="color:#676E95;"># img1 = &#39;D:\\\\BaiduNetdiskWorkspace\\\\pythonAlgorTest\\\\24A.png&#39;</span></span>
<span class="line"><span style="color:#676E95;"># img2 = &#39;D:\\\\BaiduNetdiskWorkspace\\\\pythonAlgorTest\\\\24B.png&#39;</span></span>
<span class="line"><span style="color:#676E95;"># outimg=&#39;D:\\BaiduNetdiskWorkspace\\pythonAlgorTest\\change.tif&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">img1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">img2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">outimg</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"> im_1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">img1</span></span>
<span class="line"><span style="color:#A6ACCD;"> im_2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> img2</span></span>
<span class="line"><span style="color:#A6ACCD;"> outurl </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> outimg</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">输入路径1：</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">+</span><span style="color:#82AAFF;">im_1</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">输入路径1：</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">+</span><span style="color:#82AAFF;">im_2</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#676E95;"># 载入数组</span></span>
<span class="line"><span style="color:#A6ACCD;"> arr_1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> gdal_array</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">LoadFile</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">im_1</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">astype</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">np</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">int8</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;"> arr_2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> gdal_array</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">LoadFile</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">im_2</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">astype</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">np</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">int8</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#676E95;"># # 显示两幅图像</span></span>
<span class="line"><span style="color:#676E95;"># plt.figure(figsize=(20, 40))</span></span>
<span class="line"><span style="color:#676E95;"># plt.subplot(121);plt.imshow(cv2.merge((arr_1[0], arr_1[1], arr_1[2])).astype(np.uint8))</span></span>
<span class="line"><span style="color:#676E95;"># plt.subplot(122);plt.imshow(cv2.merge((arr_2[0], arr_2[1], arr_2[2])).astype(np.uint8))</span></span>
<span class="line"><span style="color:#676E95;"># plt.show()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 进行变化检测</span></span>
<span class="line"><span style="color:#A6ACCD;"> diff </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> arr_1 </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> arr_2</span></span>
<span class="line"><span style="color:#676E95;"># 建立类别架构并将变化特征隔离</span></span>
<span class="line"><span style="color:#A6ACCD;"> classes </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">histogram</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">diff</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">bins</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">)[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#676E95;"># 用黑色遮罩遮住不明显的特征</span></span>
<span class="line"><span style="color:#A6ACCD;"> lut </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">255</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">255</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">50</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">255</span><span style="color:#89DDFF;">]]</span></span>
<span class="line"><span style="color:#676E95;"># 类别初始值</span></span>
<span class="line"><span style="color:#A6ACCD;"> start </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#676E95;"># 创建输出图片</span></span>
<span class="line"><span style="color:#A6ACCD;"> rgb </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">zeros</span><span style="color:#89DDFF;">((</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> diff</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shape</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;"> diff</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shape</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">]),</span><span style="color:#82AAFF;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">int8</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#676E95;"># 处理并分配颜色</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">range</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">classes</span><span style="color:#89DDFF;">)):</span></span>
<span class="line"><span style="color:#A6ACCD;">    mask </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">logical_and</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">start </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#82AAFF;"> diff</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> diff </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#82AAFF;"> classes</span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">i</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">    masked </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">((</span><span style="color:#A6ACCD;">mask</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> mask</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">])</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> mask</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> j </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">range</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">lut</span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">i</span><span style="color:#89DDFF;">])):</span></span>
<span class="line"><span style="color:#A6ACCD;">        rgb</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">j</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">choose</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">masked</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">rgb</span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">j</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;"> lut</span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">i</span><span style="color:#89DDFF;">][</span><span style="color:#82AAFF;">j</span><span style="color:#89DDFF;">]))</span></span>
<span class="line"><span style="color:#A6ACCD;">    strat </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> classes</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#676E95;"># 保存</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    out </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> gdal_array</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">SaveArray</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">rgb</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> outurl</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">format</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GTiff</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">im_2</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    out1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">None</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">输出路径1：</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">+</span><span style="color:#82AAFF;">outurl</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> outurl</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># # 查看差值图片</span></span>
<span class="line"><span style="color:#676E95;"># ima = &#39;D:\\BaiduNetdiskWorkspace\\pythonAlgorTest\\change.tif&#39;</span></span>
<span class="line"><span style="color:#676E95;"># arr = gdal_array.LoadFile(ima).astype(np.uint8)</span></span>
<span class="line"><span style="color:#676E95;"># plt.figure(figsize=(8, 8))</span></span>
<span class="line"><span style="color:#676E95;"># plt.imshow(cv2.merge((arr[0], arr[1], arr[2])))</span></span>
<span class="line"><span style="color:#676E95;"># plt.show()</span></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> __name__ </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">__main__</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> sys</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">argv</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    url2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">sys</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">argv</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    url3 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">sys</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">argv</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">url</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">url2</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">url3</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div>`,2),e=[o];function r(t,c,F,D,y,A){return n(),a("div",null,e)}const _=s(l,[["render",r]]);export{i as __pageData,_ as default};
