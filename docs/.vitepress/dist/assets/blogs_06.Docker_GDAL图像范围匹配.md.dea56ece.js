import{_ as s,o as n,c as a,d as p}from"./app.d40ca825.js";const l="/xuanmu-blogs/assets/img-2023-03-23-10-46-12.1723c8f7.png",m=JSON.parse('{"title":"GDAL+Python+Docker匹配图像范围","description":"","frontmatter":{},"headers":[{"level":2,"title":"基础镜像","slug":"基础镜像","link":"#基础镜像","children":[]},{"level":2,"title":"编写Dockerfile文件","slug":"编写dockerfile文件","link":"#编写dockerfile文件","children":[]},{"level":2,"title":"算法","slug":"算法","link":"#算法","children":[]},{"level":2,"title":"pipreqs ./ 获取依赖","slug":"pipreqs-获取依赖","link":"#pipreqs-获取依赖","children":[]},{"level":2,"title":"构建容器","slug":"构建容器","link":"#构建容器","children":[]},{"level":2,"title":"执行容器","slug":"执行容器","link":"#执行容器","children":[]}],"relativePath":"blogs/06.Docker/GDAL图像范围匹配.md"}'),o={name:"blogs/06.Docker/GDAL图像范围匹配.md"},e=p(`<h1 id="gdal-python-docker匹配图像范围" tabindex="-1">GDAL+Python+Docker匹配图像范围 <a class="header-anchor" href="#gdal-python-docker匹配图像范围" aria-hidden="true">#</a></h1><h2 id="基础镜像" tabindex="-1">基础镜像 <a class="header-anchor" href="#基础镜像" aria-hidden="true">#</a></h2><p><code>pull andrejreznik/python-gdal</code></p><h2 id="编写dockerfile文件" tabindex="-1">编写Dockerfile文件 <a class="header-anchor" href="#编写dockerfile文件" aria-hidden="true">#</a></h2><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;"># 配置环境</span></span>
<span class="line"><span style="color:#A6ACCD;">FROM andrejreznik/python-gdal</span></span>
<span class="line"><span style="color:#A6ACCD;"># 工作目录</span></span>
<span class="line"><span style="color:#A6ACCD;">WORKDIR ./GDAL_Docker-Clip</span></span>
<span class="line"><span style="color:#A6ACCD;"># 从本来的路径拷贝到容器指定路径，这么写最省事</span></span>
<span class="line"><span style="color:#A6ACCD;">ADD . .</span></span>
<span class="line"><span style="color:#A6ACCD;"># 配置python环境库</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple/</span></span>
<span class="line"><span style="color:#A6ACCD;"># 启动后台服务 #0不限制超时时间</span></span>
<span class="line"><span style="color:#A6ACCD;">ENTRYPOINT gunicorn run_predict:app -c gunicorn.conf.py </span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="算法" tabindex="-1">算法 <a class="header-anchor" href="#算法" aria-hidden="true">#</a></h2><div class="language-py"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki has-diff"><code><span class="line"><span style="color:#676E95;">#https://appliedmachinelearning.wordpress.com/2017/11/25/unsupervised-changed-detection-in-multi-temporal-satellite-images-using-pca-k-means-python-code/</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> cgitb </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> reset</span></span>
<span class="line"><span style="color:#676E95;"># from crypt import methods</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> email</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">mime </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> image</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> flask </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> Flask</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> flask </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> request</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> flask </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;">  Response</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">send_file</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">jsonify</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> PIL </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> Image</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> base64</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> io</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> flask </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> render_template</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> werkzeug</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">utils </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> secure_filename</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#676E95;"># 从别的文件里引用，实例化一个类，方便下面调用</span></span>
<span class="line"><span style="color:#676E95;"># from src import yingzhibiao_predict</span></span>
<span class="line"><span style="color:#676E95;"># p = yingzhibiao_predict.predictt()</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> uuid </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> uuid4</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> matplotlib</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">pyplot</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">as</span><span style="color:#A6ACCD;"> plt </span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> os</span></span>
<span class="line"><span style="color:#A6ACCD;">app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Flask</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">__name__</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> cv2</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> numpy </span><span style="color:#89DDFF;">as</span><span style="color:#A6ACCD;"> np</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> numpy </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">amin</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> amax</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> ravel</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> asarray</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> arange</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> ones</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> newaxis</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                   transpose</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> iscomplexobj</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> uint8</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> issubdtype</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> array</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> sklearn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">cluster </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> KMeans</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> sklearn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">decomposition </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> PCA</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> collections </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> Counter</span></span>
<span class="line"><span style="color:#676E95;"># from scipy.misc import imread , imresize, imsave </span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> imageio</span></span>
<span class="line"><span style="color:#676E95;"># from imageio import imread</span></span>
<span class="line"><span style="color:#676E95;"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> os</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> sys</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> osgeo </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> gdal</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> osgeo </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> osr</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> numpy </span><span style="color:#89DDFF;">as</span><span style="color:#A6ACCD;"> np</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> osgeo </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> gdalconst</span></span>
<span class="line"><span style="color:#676E95;"># from gdalconst import *</span></span>
<span class="line"><span style="color:#676E95;"># from osr import SpatialReference</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">methods</span><span style="color:#89DDFF;">=[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">index</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">render_template</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">test.html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/cliptif</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">methods</span><span style="color:#89DDFF;">=[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">cliptif</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># data = request.form</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># print(data)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># imagepath1 = request.files[&#39;img1&#39;]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># imagepath2 = request.files[&#39;img2&#39;]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># tmp_fname1 = os.path.join(&#39;Caching&#39;, uuid4().__str__()+&#39;.tif&#39;)#？？？？？</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># tmp_fname2 = os.path.join(&#39;Caching&#39;, uuid4().__str__()+&#39;.tif&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># imagepath1.save(tmp_fname1)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># imagepath2.save(tmp_fname2)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># print(&#39;Operating&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;"># 来获取多个上传文件</span></span>
<span class="line"><span style="color:#A6ACCD;">    in1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">files</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">img1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    in2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">files</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">img2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">    filename1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">secure_filename</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">in1</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">filename</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">filename1</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    in1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">save</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">os</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Caching</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> filename1</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    filename2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">secure_filename</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">in2</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">filename</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">filename2</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    in2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">save</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">os</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Caching</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> filename2</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># imageio.imwrite(&quot;./Results/t1.tif&quot;, &quot;./Caching/&quot;+filename1)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># imageio.imwrite(&quot;./Results/t2.tif&quot;,  &quot;./Caching/&quot;+filename2)   </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#     msg = &quot;http://127.0.0.1:5006/images/{}&quot;.format(filename)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#     urls.append(msg)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># respose = {</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#     &quot;code&quot;: 200,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#     &quot;urls&quot;: urls</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># }</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># return jsonify(respose)</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    args </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./Caching/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">filename1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./Caching/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">filename2</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./Results/out1.tif</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./Results/out2.tif</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">5</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">args</span><span style="color:#89DDFF;">)!=</span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Invalid parameters.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Please input:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Input path of raster 1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Input path of raster 2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Output path of raster 1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Output path of raster 2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        sys</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print </span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">参数个数为:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">args</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">个参数。</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print </span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">参数列表:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">args</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#input</span></span>
<span class="line"><span style="color:#A6ACCD;">    in_raster1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    in_raster2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    out_raster1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    out_raster2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#read raster1---------------------------------------------------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#A6ACCD;">    ds1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> gdal</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Open</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">in_raster1</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">gdal</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">GA_ReadOnly</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> ds1 </span><span style="color:#89DDFF;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">None:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">print </span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cannot open </span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">in_raster1</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        sys</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span></span>
<span class="line"><span style="color:#A6ACCD;">    gt1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ds1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">GetGeoTransform</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    proj1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ds1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">GetProjection</span><span style="color:#89DDFF;">()</span><span style="color:#676E95;">#获取投影信息</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># r1 has left, top, right, bottom of dataset&#39;s bounds in geospatial coordinates.</span></span>
<span class="line"><span style="color:#A6ACCD;">    r1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">gt1</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> gt1</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> gt1</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">gt1</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> ds1</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">RasterXSize</span><span style="color:#89DDFF;">),</span><span style="color:#A6ACCD;"> gt1</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">gt1</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> ds1</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">RasterYSize</span><span style="color:#89DDFF;">)]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#read raster2------------------------------------------------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#A6ACCD;">    ds2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> gdal</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Open</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">in_raster2</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">gdal</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">GA_ReadOnly</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> ds2 </span><span style="color:#89DDFF;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">None:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">print </span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cannot open </span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">in_raster2</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        sys</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span></span>
<span class="line"><span style="color:#A6ACCD;">    gt2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ds2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">GetGeoTransform</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    proj2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ds2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">GetProjection</span><span style="color:#89DDFF;">()</span><span style="color:#676E95;">#获取投影信息</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># r2 has left, top, right, bottom of dataset&#39;s bounds in geospatial coordinates.</span></span>
<span class="line"><span style="color:#A6ACCD;">    r2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">gt2</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> gt2</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> gt2</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">gt2</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> ds2</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">RasterXSize</span><span style="color:#89DDFF;">),</span><span style="color:#A6ACCD;"> gt2</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">gt2</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> ds2</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">RasterYSize</span><span style="color:#89DDFF;">)]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#calculate the intersection area of r1 and r2</span></span>
<span class="line"><span style="color:#A6ACCD;">    intersection </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">max</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">r1</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;"> r2</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]),</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">min</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">r1</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;"> r2</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">]),</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">min</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">r1</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;"> r2</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">]),</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">max</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">r1</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;"> r2</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">])]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#map intersection to pixel intersection</span></span>
<span class="line"><span style="color:#A6ACCD;">    intersection_pixel_r1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">geo2imagexy</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">ds1</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> intersection</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;"> intersection</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">]),</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">geo2imagexy</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">ds1</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> intersection</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;"> intersection</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">])]</span></span>
<span class="line"><span style="color:#A6ACCD;">    intersection_pixel_r2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">geo2imagexy</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">ds2</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> intersection</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;"> intersection</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">]),</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">geo2imagexy</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">ds2</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> intersection</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;"> intersection</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">])]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#read block data</span></span>
<span class="line"><span style="color:#A6ACCD;">    clip_r1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ds1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ReadAsArray</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">intersection_pixel_r1</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">][</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]),</span><span style="color:#82AAFF;"> </span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">intersection_pixel_r1</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">][</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">]),</span><span style="color:#82AAFF;"> </span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">intersection_pixel_r1</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">][</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">])-</span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">intersection_pixel_r1</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">][</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]),</span><span style="color:#82AAFF;"> </span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">intersection_pixel_r1</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">][</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">])-</span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">intersection_pixel_r1</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">][</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">]))</span></span>
<span class="line"><span style="color:#A6ACCD;">    clip_r2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ds2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ReadAsArray</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">intersection_pixel_r2</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">][</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]),</span><span style="color:#82AAFF;"> </span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">intersection_pixel_r2</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">][</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">]),</span><span style="color:#82AAFF;"> </span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">intersection_pixel_r2</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">][</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">])-</span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">intersection_pixel_r2</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">][</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]),</span><span style="color:#82AAFF;"> </span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">intersection_pixel_r2</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">][</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">])-</span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">intersection_pixel_r2</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">][</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">]))</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#output clipped raster---------------------------------------------------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#A6ACCD;">    gt_clip_r1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">intersection</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> gt1</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> gt1</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> intersection</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> gt1</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> gt1</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">]]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">writeTiff</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">clip_r1</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">clip_r1</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shape</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;">clip_r1</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shape</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;">clip_r1</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shape</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;">gt_clip_r1</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">proj1</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">out_raster1</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    gt_clip_r2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">intersection</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> gt2</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> gt2</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> intersection</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> gt2</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> gt2</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">]]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">writeTiff</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">clip_r2</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">clip_r2</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shape</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;">clip_r2</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shape</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;">clip_r2</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shape</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;">gt_clip_r2</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">proj2</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">out_raster2</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#输入t1-t2专为jpg用于显示</span></span>
<span class="line"><span style="color:#A6ACCD;">    im1in</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">Image</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Caching/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">+</span><span style="color:#82AAFF;">filename1</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    im2in</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">Image</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Caching/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">+</span><span style="color:#82AAFF;">filename2</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    im1in</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">save</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Results/in1.jpg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    im2in</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">save</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Results/in2.jpg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#676E95;">#返回显示</span></span>
<span class="line"><span style="color:#A6ACCD;">    T1_Steam </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">return_img_stream</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./Results/in1.jpg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    T2_Steam </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">return_img_stream</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./Results/in2.jpg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#输出图像转jpg用于显示</span></span>
<span class="line"><span style="color:#A6ACCD;">    im1</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">Image</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Results/out1.tif</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    im2</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">Image</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Results/out2.tif</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    im1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">save</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Results/out1.jpg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    im2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">save</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Results/out2.jpg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#返回显示图像</span></span>
<span class="line"><span style="color:#A6ACCD;">    img_stream </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">return_img_stream</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./Results/out1.jpg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    img_stream2</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">return_img_stream</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./Results/out2.jpg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#渲染html</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;">   </span><span style="color:#82AAFF;">render_template</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">test.html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">T1_Steam</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">T1_Steam</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">T2_Steam</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">T2_Steam</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">img_stream</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">img_stream</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">img_stream2</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">img_stream2</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">geo2imagexy</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">dataset</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">y</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#676E95;">    根据GDAL的六 参数模型将给定的投影或地理坐标转为影像图上坐标（行列号）</span></span>
<span class="line"><span style="color:#676E95;">    :param dataset: GDAL地理数据</span></span>
<span class="line"><span style="color:#676E95;">    :param x: 投影或地理坐标x</span></span>
<span class="line"><span style="color:#676E95;">    :param y: 投影或地理坐标y</span></span>
<span class="line"><span style="color:#676E95;">    :return: 影坐标或地理坐标(x, y)对应的影像图上行列号(row, col)</span></span>
<span class="line"><span style="color:#676E95;">    </span><span style="color:#89DDFF;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    trans </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> dataset</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">GetGeoTransform</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">array</span><span style="color:#89DDFF;">([[</span><span style="color:#82AAFF;">trans</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;"> trans</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">]],</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">trans</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;"> trans</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">]]])</span></span>
<span class="line"><span style="color:#A6ACCD;">    b </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">array</span><span style="color:#89DDFF;">([</span><span style="color:#82AAFF;">x </span><span style="color:#89DDFF;">-</span><span style="color:#82AAFF;"> trans</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;"> y </span><span style="color:#89DDFF;">-</span><span style="color:#82AAFF;"> trans</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">]])</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">linalg</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">solve</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">a</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> b</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># 使用numpy的linalg.solve进行二元一次方程的求解</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">writeTiff</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">im_data</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">im_width</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">im_height</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">im_bands</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">im_geotrans</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">im_proj</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">int8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> im_data</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">dtype</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        datatype </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> gdal</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">GDT_Byte</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">elif</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">int16</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> im_data</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">dtype</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        datatype </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> gdal</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">GDT_UInt16</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">else</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        datatype </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> gdal</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">GDT_Float32</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">im_data</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shape</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        im_bands</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> im_height</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> im_width </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> im_data</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shape</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">elif</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">im_data</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shape</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        im_data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">array</span><span style="color:#89DDFF;">([</span><span style="color:#82AAFF;">im_data</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">else</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        im_bands</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">im_height</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> im_width</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">im_data</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shape</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#创建文件</span></span>
<span class="line"><span style="color:#A6ACCD;">    driver </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> gdal</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">GetDriverByName</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">GTiff</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    dataset </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> driver</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Create</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">path</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> im_width</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> im_height</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> im_bands</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> datatype</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">if</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">dataset</span><span style="color:#89DDFF;">!=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">None):</span></span>
<span class="line"><span style="color:#A6ACCD;">        dataset</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">SetGeoTransform</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">im_geotrans</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">#写入仿射变换参数</span></span>
<span class="line"><span style="color:#A6ACCD;">        dataset</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">SetProjection</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">im_proj</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">#写入投影</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">range</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">im_bands</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        dataset</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">GetRasterBand</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">i</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">WriteArray</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">im_data</span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">i</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">:,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">:])</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">del</span><span style="color:#A6ACCD;"> dataset</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">   </span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">return_img_stream</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">img_local_path</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#676E95;">  工具函数:</span></span>
<span class="line"><span style="color:#676E95;">  获取本地图片流</span></span>
<span class="line"><span style="color:#676E95;">  :param img_local_path:文件单张图片的本地绝对路径</span></span>
<span class="line"><span style="color:#676E95;">  :return: 图片流</span></span>
<span class="line"><span style="color:#676E95;">  </span><span style="color:#89DDFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> base64</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> chardet</span></span>
<span class="line"><span style="color:#A6ACCD;">  img_stream </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  f </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">open</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">img_local_path</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rb</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> f</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">chardet</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">detect</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">with</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">open</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">img_local_path</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rb</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">as</span><span style="color:#A6ACCD;"> img_f</span><span style="color:#89DDFF;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    img_stream </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> img_f</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    img_stream </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> base64</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">b64encode</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">img_stream</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">decode</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> img_stream</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># Python已经取消scipy库中imread，imresize，imsave三个函数的使用,在文件中直接写入imresize函数源代码，</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">imresize</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">arr</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">size</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">interp</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">bilinear</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">mode</span><span style="color:#89DDFF;">=None):</span></span>
<span class="line"><span style="color:#A6ACCD;">    im </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Image</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fromarray</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">arr</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">mode</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">mode</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    ts </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">type</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">size</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">issubdtype</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">ts</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">signedinteger</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        percent </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> size </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100.0</span></span>
<span class="line"><span style="color:#A6ACCD;">        size </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">tuple</span><span style="color:#89DDFF;">((</span><span style="color:#82AAFF;">np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">array</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">im</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">size</span><span style="color:#89DDFF;">)*</span><span style="color:#82AAFF;">percent</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">astype</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">elif</span><span style="color:#A6ACCD;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">issubdtype</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">type</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">size</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">floating</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        size </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">tuple</span><span style="color:#89DDFF;">((</span><span style="color:#82AAFF;">np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">array</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">im</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">size</span><span style="color:#89DDFF;">)*</span><span style="color:#82AAFF;">size</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">astype</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">else</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        size </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">size</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> size</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">    func </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">nearest</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">lanczos</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">bilinear</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">bicubic</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cubic</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    imnew </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> im</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resize</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">size</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">resample</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">func</span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">interp</span><span style="color:#89DDFF;">])</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">array</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">imnew</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">imread</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">flatten</span><span style="color:#89DDFF;">=False,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">mode</span><span style="color:#89DDFF;">=None):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#676E95;">    Read an image from a file as an array.</span></span>
<span class="line"><span style="color:#676E95;">    This function is only available if Python Imaging Library (PIL) is installed.</span></span>
<span class="line"><span style="color:#676E95;">    Parameters</span></span>
<span class="line"><span style="color:#676E95;">    ----------</span></span>
<span class="line"><span style="color:#676E95;">    name : str or file object</span></span>
<span class="line"><span style="color:#676E95;">        The file name or file object to be read.</span></span>
<span class="line"><span style="color:#676E95;">    flatten : bool, optional</span></span>
<span class="line"><span style="color:#676E95;">        If True, flattens the color layers into a single gray-scale layer.</span></span>
<span class="line"><span style="color:#676E95;">    mode : str, optional</span></span>
<span class="line"><span style="color:#676E95;">        Mode to convert image to, e.g. \`\`&#39;RGB&#39;\`\`.  See the Notes for more</span></span>
<span class="line"><span style="color:#676E95;">        details.</span></span>
<span class="line"><span style="color:#676E95;">    Returns</span></span>
<span class="line"><span style="color:#676E95;">    -------</span></span>
<span class="line"><span style="color:#676E95;">    imread : ndarray</span></span>
<span class="line"><span style="color:#676E95;">        The array obtained by reading the image.</span></span>
<span class="line"><span style="color:#676E95;">    Notes</span></span>
<span class="line"><span style="color:#676E95;">    -----</span></span>
<span class="line"><span style="color:#676E95;">    \`imread\` uses the Python Imaging Library (PIL) to read an image.</span></span>
<span class="line"><span style="color:#676E95;">    The following notes are from the PIL documentation.</span></span>
<span class="line"><span style="color:#676E95;">    \`mode\` can be one of the following strings:</span></span>
<span class="line"><span style="color:#676E95;">    * &#39;L&#39; (8-bit pixels, black and white)</span></span>
<span class="line"><span style="color:#676E95;">    * &#39;P&#39; (8-bit pixels, mapped to any other mode using a color palette)</span></span>
<span class="line"><span style="color:#676E95;">    * &#39;RGB&#39; (3x8-bit pixels, true color)</span></span>
<span class="line"><span style="color:#676E95;">    * &#39;RGBA&#39; (4x8-bit pixels, true color with transparency mask)</span></span>
<span class="line"><span style="color:#676E95;">    * &#39;CMYK&#39; (4x8-bit pixels, color separation)</span></span>
<span class="line"><span style="color:#676E95;">    * &#39;YCbCr&#39; (3x8-bit pixels, color video format)</span></span>
<span class="line"><span style="color:#676E95;">    * &#39;I&#39; (32-bit signed integer pixels)</span></span>
<span class="line"><span style="color:#676E95;">    * &#39;F&#39; (32-bit floating point pixels)</span></span>
<span class="line"><span style="color:#676E95;">    PIL also provides limited support for a few special modes, including</span></span>
<span class="line"><span style="color:#676E95;">    &#39;LA&#39; (&#39;L&#39; with alpha), &#39;RGBX&#39; (true color with padding) and &#39;RGBa&#39;</span></span>
<span class="line"><span style="color:#676E95;">    (true color with premultiplied alpha).</span></span>
<span class="line"><span style="color:#676E95;">    When translating a color image to black and white (mode &#39;L&#39;, &#39;I&#39; or</span></span>
<span class="line"><span style="color:#676E95;">    &#39;F&#39;), the library uses the ITU-R 601-2 luma transform::</span></span>
<span class="line"><span style="color:#676E95;">        L = R * 299/1000 + G * 587/1000 + B * 114/1000</span></span>
<span class="line"><span style="color:#676E95;">    When \`flatten\` is True, the image is converted using mode &#39;F&#39;.</span></span>
<span class="line"><span style="color:#676E95;">    When \`mode\` is not None and \`flatten\` is True, the image is first</span></span>
<span class="line"><span style="color:#676E95;">    converted according to \`mode\`, and the result is then flattened using</span></span>
<span class="line"><span style="color:#676E95;">    mode &#39;F&#39;.</span></span>
<span class="line"><span style="color:#676E95;">    </span><span style="color:#89DDFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    im </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Image</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">name</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fromimage</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">im</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">flatten</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">flatten</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">mode</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">mode</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fromimage</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">im</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">flatten</span><span style="color:#89DDFF;">=False,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">mode</span><span style="color:#89DDFF;">=None):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#676E95;">    Return a copy of a PIL image as a numpy array.</span></span>
<span class="line"><span style="color:#676E95;">    This function is only available if Python Imaging Library (PIL) is installed.</span></span>
<span class="line"><span style="color:#676E95;">    Parameters</span></span>
<span class="line"><span style="color:#676E95;">    ----------</span></span>
<span class="line"><span style="color:#676E95;">    im : PIL image</span></span>
<span class="line"><span style="color:#676E95;">        Input image.</span></span>
<span class="line"><span style="color:#676E95;">    flatten : bool</span></span>
<span class="line"><span style="color:#676E95;">        If true, convert the output to grey-scale.</span></span>
<span class="line"><span style="color:#676E95;">    mode : str, optional</span></span>
<span class="line"><span style="color:#676E95;">        Mode to convert image to, e.g. \`\`&#39;RGB&#39;\`\`.  See the Notes of the</span></span>
<span class="line"><span style="color:#676E95;">        \`imread\` docstring for more details.</span></span>
<span class="line"><span style="color:#676E95;">    Returns</span></span>
<span class="line"><span style="color:#676E95;">    -------</span></span>
<span class="line"><span style="color:#676E95;">    fromimage : ndarray</span></span>
<span class="line"><span style="color:#676E95;">        The different colour bands/channels are stored in the</span></span>
<span class="line"><span style="color:#676E95;">        third dimension, such that a grey-image is MxN, an</span></span>
<span class="line"><span style="color:#676E95;">        RGB-image MxNx3 and an RGBA-image MxNx4.</span></span>
<span class="line"><span style="color:#676E95;">    </span><span style="color:#89DDFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">not</span><span style="color:#A6ACCD;"> Image</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isImageType</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">im</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">raise</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TypeError</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Input is not a PIL image.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> mode </span><span style="color:#89DDFF;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">not</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">None:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> mode </span><span style="color:#89DDFF;">!=</span><span style="color:#A6ACCD;"> im</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">mode</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            im </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> im</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">convert</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">mode</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">elif</span><span style="color:#A6ACCD;"> im</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">mode</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">P</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># Mode &#39;P&#39; means there is an indexed &quot;palette&quot;.  If we leave the mode</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># as &#39;P&#39;, then when we do \`a = array(im)\` below, \`a\` will be a 2-D</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># containing the indices into the palette, and not a 3-D array</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># containing the RGB or RGBA values.</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">transparency</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> im</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">info</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            im </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> im</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">convert</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">RGBA</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">else</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            im </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> im</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">convert</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">RGB</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> flatten</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        im </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> im</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">convert</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">F</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">elif</span><span style="color:#A6ACCD;"> im</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">mode</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># Workaround for crash in PIL. When im is 1-bit, the call array(im)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># can cause a seg. fault, or generate garbage. See</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># https://github.com/scipy/scipy/issues/2138 and</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># https://github.com/python-pillow/Pillow/issues/350.</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># This converts im from a 1-bit image to an 8-bit image.</span></span>
<span class="line"><span style="color:#A6ACCD;">        im </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> im</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">convert</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">L</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">array</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">im</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> a</span></span>
<span class="line"><span style="color:#A6ACCD;">_errstr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Mode is unknown or incompatible with input array shape.</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># docker启动服务不会走main函数</span></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> __name__ </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">__main__</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">run</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h2 id="pipreqs-获取依赖" tabindex="-1">pipreqs ./ 获取依赖 <a class="header-anchor" href="#pipreqs-获取依赖" aria-hidden="true">#</a></h2><p>gdal 容器内已经存在 故不在这里安装</p><div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">chardet==5.1.0</span></span>
<span class="line"><span style="color:#A6ACCD;">Flask==2.2.2</span></span>
<span class="line"><span style="color:#A6ACCD;">numpy==1.21.5</span></span>
<span class="line"><span style="color:#A6ACCD;">Pillow==9.4.0</span></span>
<span class="line"><span style="color:#A6ACCD;">Werkzeug==2.2.2</span></span>
<span class="line"><span style="color:#A6ACCD;">gunicorn==20.1.0</span></span>
<span class="line"><span style="color:#A6ACCD;">gevent==21.12.0</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="构建容器" tabindex="-1">构建容器 <a class="header-anchor" href="#构建容器" aria-hidden="true">#</a></h2><p><code>sudo docker build -t gdal_crop:v2 . </code></p><h2 id="执行容器" tabindex="-1">执行容器 <a class="header-anchor" href="#执行容器" aria-hidden="true">#</a></h2><p><code>docker run -itd -p 5050:5000 gdal_crop:v2 </code></p><p><img src="`+l+'" alt=""></p>',15),t=[e];function c(r,F,D,y,A,C){return n(),a("div",null,t)}const d=s(o,[["render",c]]);export{m as __pageData,d as default};
