import{_ as s,o as a,c as n,d as l}from"./app.aa9aa19b.js";const p="/xuanmu-blogs/assets/img-2023-01-05-22-02-51.f626957a.png",o="/xuanmu-blogs/assets/img-2023-01-05-22-02-57.8c044455.png",e="/xuanmu-blogs/assets/img-2023-01-05-22-03-05.13bbcaa3.png",t="/xuanmu-blogs/assets/img-2023-01-05-22-03-26.9ff70804.png",r="/xuanmu-blogs/assets/img-2023-01-05-22-03-40.faa8b9ef.png",c="/xuanmu-blogs/assets/img-2023-01-05-22-04-05.90cf1afa.png",F="/xuanmu-blogs/assets/img-2023-01-05-22-04-17.096707a0.png",D="/xuanmu-blogs/assets/img-2023-01-05-22-04-43.7a02124a.png",y="/xuanmu-blogs/assets/img-2023-01-05-22-04-52.0ad0e482.png",A="/xuanmu-blogs/assets/img-2023-01-05-22-04-59.9443387e.png",i="/xuanmu-blogs/assets/img-2023-01-05-22-05-55.353a7a1f.png",C="/xuanmu-blogs/assets/img-2023-01-05-22-06-00.f83a55db.png",d="/xuanmu-blogs/assets/img-2023-01-05-22-06-12.c1d75137.png",_="/xuanmu-blogs/assets/img-2023-01-05-22-06-17.ce774197.png",I=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[{"level":2,"title":"1 Dockerfile文件制作","slug":"_1-dockerfile文件制作","link":"#_1-dockerfile文件制作","children":[]},{"level":2,"title":"2 python需要封装的文件","slug":"_2-python需要封装的文件","link":"#_2-python需要封装的文件","children":[]},{"level":2,"title":"3 获取项目所需依赖","slug":"_3-获取项目所需依赖","link":"#_3-获取项目所需依赖","children":[]},{"level":2,"title":"4 创建image镜像","slug":"_4-创建image镜像","link":"#_4-创建image镜像","children":[]},{"level":2,"title":"5 执行镜像","slug":"_5-执行镜像","link":"#_5-执行镜像","children":[]},{"level":2,"title":"6 保存镜像文件","slug":"_6-保存镜像文件","link":"#_6-保存镜像文件","children":[]},{"level":2,"title":"7 删除镜像","slug":"_7-删除镜像","link":"#_7-删除镜像","children":[]},{"level":2,"title":"8 重新导入镜像","slug":"_8-重新导入镜像","link":"#_8-重新导入镜像","children":[]},{"level":2,"title":"9 请求算法","slug":"_9-请求算法","link":"#_9-请求算法","children":[]},{"level":2,"title":"10 Windows部署","slug":"_10-windows部署","link":"#_10-windows部署","children":[]}],"relativePath":"blogs/06.Docker/NDVI算法封装.md"}'),m={name:"blogs/06.Docker/NDVI算法封装.md"},u=l('<div class="tip custom-block"><p class="custom-block-title">TIP</p><p>2022-10-11 王海航 Docker NDVI 模型封装</p></div><p><img src="'+p+'" alt=""></p><h2 id="_1-dockerfile文件制作" tabindex="-1">1 Dockerfile文件制作 <a class="header-anchor" href="#_1-dockerfile文件制作" aria-hidden="true">#</a></h2><p><img src="'+o+'" alt=""></p><h2 id="_2-python需要封装的文件" tabindex="-1">2 python需要封装的文件 <a class="header-anchor" href="#_2-python需要封装的文件" aria-hidden="true">#</a></h2><p><img src="'+e+`" alt=""></p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/test</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">methods</span><span style="color:#89DDFF;">=[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">en</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">     b2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">files</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">b2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">     b4 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">files</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">b4</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">     tmp_fname2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> os</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">uploads</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> uuid4</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">__str__</span><span style="color:#89DDFF;">())</span></span>
<span class="line"><span style="color:#A6ACCD;">     tmp_fname4 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> os</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">uploads</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> uuid4</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">__str__</span><span style="color:#89DDFF;">())</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">     b2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">save</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">tmp_fname2</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">     b4</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">save</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">tmp_fname4</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">     size  </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Image</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">tmp_fname2</span><span style="color:#89DDFF;">).</span><span style="color:#F07178;">size</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">size</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">     b2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> cv</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">imread</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">tmp_fname2</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">max</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">array</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">b2</span><span style="color:#89DDFF;">)))</span></span>
<span class="line"><span style="color:#A6ACCD;">     b4 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> cv</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">imread</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">tmp_fname4</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">max</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">array</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">b4</span><span style="color:#89DDFF;">)))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">     </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#影像运算（+，-，*，/）</span></span>
<span class="line"><span style="color:#A6ACCD;">     sub </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">b2 </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> b4</span><span style="color:#89DDFF;">)*</span><span style="color:#F78C6C;">1.0</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#82AAFF;">sum</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">b2 </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> b4</span><span style="color:#89DDFF;">)*</span><span style="color:#F78C6C;">1.0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">     result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> cv</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">divide</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">sub</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> sum</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#结果影像为三波段，取第一波段</span></span>
<span class="line"><span style="color:#A6ACCD;">     result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> result</span><span style="color:#89DDFF;">[:,:,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">     result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">result </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">255.0</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">#阈值分割，括号内的result&lt;=1为阈值分割</span></span>
<span class="line"><span style="color:#A6ACCD;">     data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> base64</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">b64encode</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">result</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">decode</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">     result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> result</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">astype</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">np</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">uint8</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">     result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Image</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fromarray</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">result</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;">#result.show()</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">     os</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">remove</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">tmp_fname2</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">     os</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">remove</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">tmp_fname4</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">     imgByteArr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> io</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">BytesIO</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">     result</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">save</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">imgByteArr</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">format</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">TIFF</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">     imgByteArr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> imgByteArr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getvalue</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> imgByteArr</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h2 id="_3-获取项目所需依赖" tabindex="-1">3 获取项目所需依赖 <a class="header-anchor" href="#_3-获取项目所需依赖" aria-hidden="true">#</a></h2><p>打开命令提示符，将路径切换到需要生成依赖的项目的根目录下，依次输入： pip install pipreqs pipreqs ./</p><p><img src="`+t+'" alt=""></p><h2 id="_4-创建image镜像" tabindex="-1">4 创建image镜像 <a class="header-anchor" href="#_4-创建image镜像" aria-hidden="true">#</a></h2><p><code>sudo docker build -t demo_flask:v1 .</code></p><p><img src="'+r+'" alt=""></p><h2 id="_5-执行镜像" tabindex="-1">5 执行镜像 <a class="header-anchor" href="#_5-执行镜像" aria-hidden="true">#</a></h2><p><code>sudo docker run -it --rm -p 8000:8000 demo_flask:v1</code></p><p><img src="'+c+'" alt=""></p><h2 id="_6-保存镜像文件" tabindex="-1">6 保存镜像文件 <a class="header-anchor" href="#_6-保存镜像文件" aria-hidden="true">#</a></h2><p><code>docker save -o demo_flask.tar demo_flask:v1</code></p><p><img src="'+F+'" alt=""></p><h2 id="_7-删除镜像" tabindex="-1">7 删除镜像 <a class="header-anchor" href="#_7-删除镜像" aria-hidden="true">#</a></h2><p><code>docker rmi 镜像id</code></p><h2 id="_8-重新导入镜像" tabindex="-1">8 重新导入镜像 <a class="header-anchor" href="#_8-重新导入镜像" aria-hidden="true">#</a></h2><p><code>docker load -i demo_flask.tar</code></p><h2 id="_9-请求算法" tabindex="-1">9 请求算法 <a class="header-anchor" href="#_9-请求算法" aria-hidden="true">#</a></h2><p><img src="'+D+'" alt=""></p><p><img src="'+y+'" alt=""></p><p><img src="'+A+'" alt=""></p><h2 id="_10-windows部署" tabindex="-1">10 Windows部署 <a class="header-anchor" href="#_10-windows部署" aria-hidden="true">#</a></h2><p><img src="'+i+'" alt=""></p><p><img src="'+C+'" alt=""></p><p><img src="'+d+'" alt=""></p><p><img src="'+_+'" alt=""></p>',32),h=[u];function g(b,f,k,v,x,E){return a(),n("div",null,h)}const T=s(m,[["render",g]]);export{I as __pageData,T as default};
