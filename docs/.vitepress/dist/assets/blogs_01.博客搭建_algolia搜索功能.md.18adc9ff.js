import{_ as s,o as a,c as n,d as l}from"./app.aa9aa19b.js";const o="/xuanmu-blogs/assets/img-2023-03-27-21-01-28.2dfec8b2.png",p="/xuanmu-blogs/assets/img-2023-03-27-21-01-45.5c9cfa4f.png",e="/xuanmu-blogs/assets/img-2023-03-27-21-04-22.f7938d42.png",t="/xuanmu-blogs/assets/img-2023-03-28-10-36-02.2139214e.png",g=JSON.parse('{"title":"algolia 在线搜索 & flexsearch离线搜索","description":"","frontmatter":{},"headers":[{"level":2,"title":"申请","slug":"申请","link":"#申请","children":[]},{"level":2,"title":"账号与创建应用","slug":"账号与创建应用","link":"#账号与创建应用","children":[{"level":3,"title":"1. 申请通过后接受自动创建","slug":"_1-申请通过后接受自动创建","link":"#_1-申请通过后接受自动创建","children":[]},{"level":3,"title":"2.手动创建","slug":"_2-手动创建","link":"#_2-手动创建","children":[]}]},{"level":2,"title":"私钥放在 Github Secrets 中","slug":"私钥放在-github-secrets-中","link":"#私钥放在-github-secrets-中","children":[]},{"level":2,"title":"创建 crawlerConfig.json","slug":"创建-crawlerconfig-json","link":"#创建-crawlerconfig-json","children":[]},{"level":2,"title":"编写 CI 脚本","slug":"编写-ci-脚本","link":"#编写-ci-脚本","children":[]},{"level":2,"title":"在项目中接入","slug":"在项目中接入","link":"#在项目中接入","children":[]},{"level":2,"title":"本地Docker爬取","slug":"本地docker爬取","link":"#本地docker爬取","children":[]},{"level":2,"title":"使用fleaxsearch离线搜索","slug":"使用fleaxsearch离线搜索","link":"#使用fleaxsearch离线搜索","children":[{"level":3,"title":"不使用域名处理","slug":"不使用域名处理","link":"#不使用域名处理","children":[]}]},{"level":2,"title":"自己更改vue组件","slug":"自己更改vue组件","link":"#自己更改vue组件","children":[]}],"relativePath":"blogs/01.博客搭建/algolia搜索功能.md"}'),c={name:"blogs/01.博客搭建/algolia搜索功能.md"},r=l('<h1 id="algolia-在线搜索-flexsearch离线搜索" tabindex="-1">algolia 在线搜索 &amp; flexsearch离线搜索 <a class="header-anchor" href="#algolia-在线搜索-flexsearch离线搜索" aria-hidden="true">#</a></h1><p><a href="https://www.algolia.com/apps/Z57D5U0Y2O/dashboard" target="_blank" rel="noreferrer">https://www.algolia.com/apps/Z57D5U0Y2O/dashboard</a></p><h2 id="申请" tabindex="-1">申请 <a class="header-anchor" href="#申请" aria-hidden="true">#</a></h2><p><img src="'+o+'" alt=""><img src="'+p+'" alt=""><img src="'+e+`" alt=""></p><h2 id="账号与创建应用" tabindex="-1">账号与创建应用 <a class="header-anchor" href="#账号与创建应用" aria-hidden="true">#</a></h2><h3 id="_1-申请通过后接受自动创建" tabindex="-1">1. 申请通过后接受自动创建 <a class="header-anchor" href="#_1-申请通过后接受自动创建" aria-hidden="true">#</a></h3><h3 id="_2-手动创建" tabindex="-1">2.手动创建 <a class="header-anchor" href="#_2-手动创建" aria-hidden="true">#</a></h3><p>登录之后会进入控制台页面，点击右上角头像，会有一个设置选项，之后来到 Applications 这里，去创建一个应用</p><h2 id="私钥放在-github-secrets-中" tabindex="-1">私钥放在 Github Secrets 中 <a class="header-anchor" href="#私钥放在-github-secrets-中" aria-hidden="true">#</a></h2><p>将上述获取的 Admin API Key 添加到 Github Secrets 中，如下图所示，创建 API_KEY 和 APPLICATION_ID 两个字段，一会在 ci 中会使用到。</p><h2 id="创建-crawlerconfig-json" tabindex="-1">创建 crawlerConfig.json <a class="header-anchor" href="#创建-crawlerconfig-json" aria-hidden="true">#</a></h2><p>在项目的根目录下创建 crawlerConfig.json 文件，内容如下，注意前两个字段需要进行替换。这是告诉 algolia 需要爬取的配置。</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">index_name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">xuanmu-blogs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// 填写自己的索引名称</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">start_urls</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://whh-meteor.github.io/xuanmu-blogs/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// 填写自己的网站地址</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">rateLimit</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">maxDepth</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">selectors</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">lvl0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">selector</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">defaultValue</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Documentation</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">lvl1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.content h1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">lvl2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.content h2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">lvl3</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.content h3</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">lvl4</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.content h4</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">lvl5</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.content h5</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">content</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.content p, .content li</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">selectors_exclude</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">aside</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.page-footer</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.next-and-prev-link</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.table-of-contents</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">js_render</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="编写-ci-脚本" tabindex="-1">编写 CI 脚本 <a class="header-anchor" href="#编写-ci-脚本" aria-hidden="true">#</a></h2><p>在项目根目录.github/workflows 文件夹下，创建 algolia.yml 文件（名称可更改，自定义），粘贴如下内容：</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki"><code><span class="line"><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">algolia</span></span>
<span class="line"><span style="color:#FF9CAC;">on</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">push</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">branches</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">main</span></span>
<span class="line"><span style="color:#F07178;">jobs</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">algolia</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">runs-on</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ubuntu-latest</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">steps</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">actions/checkout@v2</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Get the content of algolia.json as config</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">id</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">algolia_config</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">echo &quot;config=$(cat crawlerConfig.json | jq -r tostring)&quot; &gt;&gt; $GITHUB_OUTPUT</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Push indices to Algolia</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">signcl/docsearch-scraper-action@master</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">env</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">APPLICATION_ID</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\${{ secrets.APPLICATION_ID }}</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">API_KEY</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\${{ secrets.API_KEY }}</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">CONFIG</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\${{ steps.algolia_config.outputs.config }}</span></span>
<span class="line"></span></code></pre></div><p>解释一下：这里 yml 就是使用 Github Actions 在 Docker 中执行的 AlgoliaDocSearch scraper action，当我们推送到 main 分支时就会立即执行这个任务，当然如果你是 master 分支只需要修改 branches 那里的值即可。</p><h2 id="在项目中接入" tabindex="-1">在项目中接入 <a class="header-anchor" href="#在项目中接入" aria-hidden="true">#</a></h2><p>测试密钥 修改github密钥 1</p><p>报错 Crawling issue: nbHits 0 for xuanmu 暂时不知道为什么 尝试一下本地Docker爬去</p><h2 id="本地docker爬取" tabindex="-1">本地Docker爬取 <a class="header-anchor" href="#本地docker爬取" aria-hidden="true">#</a></h2><p>安装jq <code>brew install jq</code></p><p><code>docker run -it --env-file=.env -e &quot;CONFIG=$(cat crawlerConfig.json | jq -r tostring)&quot; algolia/docsearch-scraper</code></p><p>报错algoliasearch.exceptions.AlgoliaUnreachableHostException: Unreachable hosts</p><p>失败</p><h2 id="使用fleaxsearch离线搜索" tabindex="-1">使用fleaxsearch离线搜索 <a class="header-anchor" href="#使用fleaxsearch离线搜索" aria-hidden="true">#</a></h2><ul><li>参考:</li></ul><p><a href="https://github.com/emersonbottero/vitepress-plugin-search" target="_blank" rel="noreferrer">https://github.com/emersonbottero/vitepress-plugin-search</a><a href="https://chodocs.cn/program/vitepress-local-search/" target="_blank" rel="noreferrer">https://chodocs.cn/program/vitepress-local-search/</a></p><ul><li><p>小坑： 索引地址在包含二级/xuanmu-blogs，在config.js中修改base为“/”后可以正常使用，但这样在github中部署就会出现问题， 绑定域名 将“https：<a href="/xuanmu-blogs/whh-metor.github.io/xuanmu-blogs/”绑定到“www.re-0.com”不包含二级目录后可以正常使用.html">//whh-metor.github.io/xuanmu-blogs/”绑定到“www.re-0.com”不包含二级目录后可以正常使用</a></p><p><img src="`+t+'" alt=""></p></li></ul><h3 id="不使用域名处理" tabindex="-1">不使用域名处理 <a class="header-anchor" href="#不使用域名处理" aria-hidden="true">#</a></h3><p><a href="https://www.bilibili.com/video/BV1yT411X7AY/" target="_blank" rel="noreferrer">https://www.bilibili.com/video/BV1yT411X7AY/</a></p><h2 id="自己更改vue组件" tabindex="-1">自己更改vue组件 <a class="header-anchor" href="#自己更改vue组件" aria-hidden="true">#</a></h2><p>onMounted(async () =&gt; { const data = await import(&quot;virtual:search-data&quot;); INDEX_DATA.value = data.default.INDEX_DATA; PREVIEW_LOOKUP.value = data.default.PREVIEW_LOOKUP; Options.value = data.default.Options; // origin.value = window.location.origin + withBase(locale.value === &#39;root&#39; ? &#39;/&#39; : locale.value); origin.value = window.location.origin + withBase(&quot;/&quot;);</p>',33),D=[r];function i(F,y,C,u,A,h){return a(),n("div",null,D)}const q=s(c,[["render",i]]);export{g as __pageData,q as default};
