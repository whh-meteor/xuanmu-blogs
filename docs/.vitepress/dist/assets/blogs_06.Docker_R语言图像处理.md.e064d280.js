import{_ as s,o as n,c as a,d as l}from"./app.715ab68d.js";const p="/xuanmu-blogs/assets/img-2023-03-07-13-58-03.0f098592.png",o="/xuanmu-blogs/assets/img-2023-03-07-13-58-44.caf1d9e9.png",e="/xuanmu-blogs/assets/img-2023-03-07-14-03-57.8b116e4e.png",t="/xuanmu-blogs/assets/img-2023-03-07-15-09-11.b4712db8.png",c="/xuanmu-blogs/assets/img-2023-03-07-15-10-16.05bfa302.png",r="/xuanmu-blogs/assets/img-2023-03-08-13-21-57.dc37ca72.png",q=JSON.parse('{"title":"R 图像处理","description":"","frontmatter":{},"headers":[{"level":2,"title":"安装图像处理库","slug":"安装图像处理库","link":"#安装图像处理库","children":[]},{"level":2,"title":"R语言函数","slug":"r语言函数","link":"#r语言函数","children":[]},{"level":2,"title":"R语言 交互","slug":"r语言-交互","link":"#r语言-交互","children":[{"level":3,"title":"本地测试","slug":"本地测试","link":"#本地测试","children":[]}]},{"level":2,"title":"部署测试","slug":"部署测试","link":"#部署测试","children":[{"level":3,"title":"dockerfile 构建镜像","slug":"dockerfile-构建镜像","link":"#dockerfile-构建镜像","children":[]}]},{"level":2,"title":"但此时无法执行既定程序 ！！","slug":"但此时无法执行既定程序","link":"#但此时无法执行既定程序","children":[]},{"level":2,"title":"重写dockerfile","slug":"重写dockerfile","link":"#重写dockerfile","children":[{"level":3,"title":"执行命令","slug":"执行命令","link":"#执行命令","children":[]},{"level":3,"title":"错误 writeJPEG 无法 创建图像","slug":"错误-writejpeg-无法-创建图像","link":"#错误-writejpeg-无法-创建图像","children":[]},{"level":3,"title":"可能是权限问题？","slug":"可能是权限问题","link":"#可能是权限问题","children":[]}]}],"relativePath":"blogs/06.Docker/R语言图像处理.md"}'),F={name:"blogs/06.Docker/R语言图像处理.md"},y=l(`<h1 id="r-图像处理" tabindex="-1">R 图像处理 <a class="header-anchor" href="#r-图像处理" aria-hidden="true">#</a></h1><h2 id="安装图像处理库" tabindex="-1">安装图像处理库 <a class="header-anchor" href="#安装图像处理库" aria-hidden="true">#</a></h2><div class="language-R"><button title="Copy Code" class="copy"></button><span class="lang">R</span><pre class="shiki"><code><span class="line"><span style="color:#82AAFF;">install.packages</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">BiocManager</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">BiocManager</span><span style="color:#F78C6C;">::</span><span style="color:#A6ACCD;">install</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">EBImage</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="r语言函数" tabindex="-1">R语言函数 <a class="header-anchor" href="#r语言函数" aria-hidden="true">#</a></h2><div class="language-R"><button title="Copy Code" class="copy"></button><span class="lang">R</span><pre class="shiki"><code><span class="line"></span>
<span class="line"><span style="color:#82AAFF;">library</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">EBImage</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">erodes</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">path, thr</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  shapes </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#A6ACCD;"> readImage</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;">kern</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> makeBrush</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">thr</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">shape</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">diamond</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;">shapes_erode</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> erode</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">shapes</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">kern</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 腐蚀</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;">shapes_dilate</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> dilate</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">shapes</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">kern</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 膨胀</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">#display(combine(shapes,shapes_erode, shapes_dilate), </span></span>
<span class="line"><span style="color:#A6ACCD;">  display</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">combine</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">shapes</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">shapes_erode</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> </span></span>
<span class="line"><span style="color:#82AAFF;">          </span><span style="color:#A6ACCD;">all</span><span style="color:#89DDFF;">=TRUE,</span><span style="color:#A6ACCD;">method</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">browser</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">nx</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>调用函数</p><div class="language-R"><button title="Copy Code" class="copy"></button><span class="lang">R</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">erodes</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">changemap.jpg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">9</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="r语言-交互" tabindex="-1">R语言 交互 <a class="header-anchor" href="#r语言-交互" aria-hidden="true">#</a></h2><p>R语言的交互式个痛点，在Docker中封装后需要有框架解决交互问题</p><p>因此我们引入UI框架shiny</p><h3 id="本地测试" tabindex="-1">本地测试 <a class="header-anchor" href="#本地测试" aria-hidden="true">#</a></h3><p>在同一文件夹下面 放置ui.r和server.r</p><p>执行Run App</p><p><img src="`+p+'" alt=""></p><p>在浏览器中打开</p><p><img src="'+o+'" alt=""></p><p>可以通过UI对图像进行处理</p><h2 id="部署测试" tabindex="-1">部署测试 <a class="header-anchor" href="#部署测试" aria-hidden="true">#</a></h2><ul><li>shiny server 封装好的交互组件需要进行部署，不然没有办法在docker中进行使用 因此我们使用镜像 rocker/r-ver:3.6.3</li></ul><p><a href="https://github.com/rocker-org/shiny" target="_blank" rel="noreferrer">https://github.com/rocker-org/shiny</a></p><ul><li>克隆项目 <code>git clone git@github.com:rocker-org/shiny.git</code> 把ui.r 和 server .r 在目录中替换</li></ul><p><img src="'+e+`" alt=""></p><ul><li>拉取镜像 把镜像拉取到本地仓库</li></ul><p><code>docker pull rocker/r-ver:3.6.3</code></p><h3 id="dockerfile-构建镜像" tabindex="-1">dockerfile 构建镜像 <a class="header-anchor" href="#dockerfile-构建镜像" aria-hidden="true">#</a></h3><div class="language-docker"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki"><code><span class="line"></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> rocker/r-ver:3.6.3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> apt-get update &amp;&amp; apt-get install -y \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    sudo \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    gdebi-core \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    pandoc \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    pandoc-citeproc \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    libcurl4-gnutls-dev \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    libcairo2-dev \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    libxt-dev \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    xtail \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    wget</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># Download and install shiny server</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> wget --no-verbose https://download3.rstudio.org/ubuntu-14.04/x86_64/VERSION -O </span><span style="color:#C3E88D;">&quot;version.txt&quot;</span><span style="color:#A6ACCD;"> &amp;&amp; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    VERSION=$(cat version.txt)  &amp;&amp; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    wget --no-verbose </span><span style="color:#C3E88D;">&quot;https://download3.rstudio.org/ubuntu-14.04/x86_64/shiny-server-$VERSION-amd64.deb&quot;</span><span style="color:#A6ACCD;"> -O ss-latest.deb &amp;&amp; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    gdebi -n ss-latest.deb &amp;&amp; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    rm -f version.txt ss-latest.deb &amp;&amp; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    . /etc/environment &amp;&amp; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    R -e </span><span style="color:#C3E88D;">&quot;install.packages(c(&#39;shiny&#39;, &#39;rmarkdown&#39;), repos=&#39;$MRAN&#39;)&quot;</span><span style="color:#A6ACCD;"> &amp;&amp; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    cp -R /usr/local/lib/R/site-library/shiny/examples/* /srv/shiny-server/ &amp;&amp; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    chown shiny:shiny /var/lib/shiny-server</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> R -e </span><span style="color:#C3E88D;">&quot;install.packages(&#39;BiocManager&#39;)&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> R -e </span><span style="color:#C3E88D;">&quot;BiocManager::install(&#39;EBImage&#39;)&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> R -e </span><span style="color:#C3E88D;">&quot;install.packages(&#39;shiny&#39;)&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> R -e </span><span style="color:#C3E88D;">&quot;install.packages(&#39;htmlwidgets&#39;)&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">EXPOSE</span><span style="color:#A6ACCD;"> 3838</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">COPY</span><span style="color:#A6ACCD;"> shiny-server.sh /usr/bin/shiny-server.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">CMD</span><span style="color:#A6ACCD;"> [</span><span style="color:#C3E88D;">&quot;/usr/bin/shiny-server.sh&quot;</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><ul><li>执行容器 sudo docker run -itd -p 3838:3838 rshiny/server:v1</li></ul><p><img src="`+t+'" alt=""></p><p>容器已经被成功创建</p><ul><li><p>挂载应用 查看文档 需要在执行docker run 的时候使用-v挂载到特定目录上</p><p><img src="'+c+`" alt=""></p><p>执行命令 <code>docker run </code></p></li></ul><h2 id="但此时无法执行既定程序" tabindex="-1">但此时无法执行既定程序 ！！ <a class="header-anchor" href="#但此时无法执行既定程序" aria-hidden="true">#</a></h2><h2 id="重写dockerfile" tabindex="-1">重写dockerfile <a class="header-anchor" href="#重写dockerfile" aria-hidden="true">#</a></h2><div class="language-docker"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;"># get shiny server and R from the rocker project</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> rocker/shiny-verse:4.0.5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># system libraries</span></span>
<span class="line"><span style="color:#676E95;"># Try to only install system libraries you actually need</span></span>
<span class="line"><span style="color:#676E95;"># Package Manager is a good resource to help discover system deps</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> apt-get update &amp;&amp; apt-get install -y \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    libcurl4-gnutls-dev \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    libssl-dev </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> apt-get update &amp;&amp; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    apt-get install -y default-libmysqlclient-dev</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> apt-get update \\</span></span>
<span class="line"><span style="color:#A6ACCD;"> &amp;&amp; apt-get install -y --no-install-recommends \\</span></span>
<span class="line"><span style="color:#A6ACCD;">   libfftw3-dev \\</span></span>
<span class="line"><span style="color:#A6ACCD;">   gcc &amp;&amp; apt-get clean \\</span></span>
<span class="line"><span style="color:#A6ACCD;"> &amp;&amp; rm -rf /var/lib/apt/lists/*</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> apt update</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> apt-get install -y curl</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> apt-get -y install libcurl4-openssl-dev</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#676E95;"># install R packages required </span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> R -e </span><span style="color:#C3E88D;">&#39;install.packages(c(&quot;DBI&quot;,&quot;tidyverse&quot;, &quot;shiny&quot;, &quot;plotly&quot;,&quot;googleCloudStorageR&quot;,&quot;shinyWidgets&quot;,&quot;BiocManager&quot;), \\</span></span>
<span class="line"><span style="color:#C3E88D;">            repos=&quot;https://packagemanager.rstudio.com/cran/__linux__/focal/2021-04-23&quot;\\</span></span>
<span class="line"><span style="color:#C3E88D;">          )&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> R -e </span><span style="color:#C3E88D;">&quot;install.packages(&#39;RMySQL&#39;, repos=&#39;http://cran.rstudio.com/&#39;, version=&#39;0.10.21&#39;, dependencies=TRUE)&quot;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># install required R libraries https://stackoverflow.com/questions/70991621/installing-r-package-decipher-in-a-docker-image https://gist.github.com/zoevanhavre/ed78a14db3a8763e15457f04764b40e6</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> Rscript -e </span><span style="color:#C3E88D;">&#39;requireNamespace(&quot;BiocManager&quot;); BiocManager::install();&#39;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">&amp;&amp; Rscript -e </span><span style="color:#C3E88D;">&#39;requireNamespace(&quot;BiocManager&quot;); BiocManager::install(&quot;EBImage&quot;)&#39;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># copy the app directory into the image</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">COPY</span><span style="color:#A6ACCD;"> ./shiny-app/* /srv/shiny-server/</span></span>
<span class="line"><span style="color:#676E95;"># RUN mkdir -p /srv/shiny-server/tmpdata</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># run app</span></span>
<span class="line"><span style="color:#F78C6C;">CMD</span><span style="color:#A6ACCD;"> [</span><span style="color:#C3E88D;">&quot;/usr/bin/shiny-server&quot;</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"></span></code></pre></div><h3 id="执行命令" tabindex="-1">执行命令 <a class="header-anchor" href="#执行命令" aria-hidden="true">#</a></h3><p>sudo docker build -t r_shiny-ebimage:v10 .</p><h3 id="错误-writejpeg-无法-创建图像" tabindex="-1">错误 writeJPEG 无法 创建图像 <a class="header-anchor" href="#错误-writejpeg-无法-创建图像" aria-hidden="true">#</a></h3><p>RUN R -e &quot;install.packages(&#39;jpeg&#39;, dependencies=TRUE)&quot;</p><p>并在代码中调用库library(&#39;jpeg&#39;)</p><p>无法使用！！！</p><h3 id="可能是权限问题" tabindex="-1">可能是权限问题？ <a class="header-anchor" href="#可能是权限问题" aria-hidden="true">#</a></h3><p>给app目录放开文件权限为最大</p><div class="language-docker"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki"><code><span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> chmod -R 777 /srv/shiny-server</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> chmod -R 777 /srv</span></span>
<span class="line"></span></code></pre></div><ol><li>构建镜像 <code>sudo docker build -t r_shiny-ebimage:v20 . </code></li><li>执行镜像<br><code>sudo docker run -itd -p 3838:3838 r_shiny-ebimage:v20</code> -itd 服务停止不终止容器； -p 映射端口号;</li></ol><p>成功执行程序@！ <img src="`+r+`" alt=""></p><p>同时url支持https</p><h1 id="完整的dockerfile" tabindex="-1">完整的Dockerfile <a class="header-anchor" href="#完整的dockerfile" aria-hidden="true">#</a></h1><p>可能包含一些不必要的组件</p><div class="language-docker"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;"># get shiny server and R from the rocker project</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> rocker/shiny-verse:4.0.5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># system libraries</span></span>
<span class="line"><span style="color:#676E95;"># Try to only install system libraries you actually need</span></span>
<span class="line"><span style="color:#676E95;"># Package Manager is a good resource to help discover system deps</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> apt-get update &amp;&amp; apt-get install -y \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    libcurl4-gnutls-dev \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    libssl-dev </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> apt-get update &amp;&amp; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    apt-get install -y default-libmysqlclient-dev</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> apt-get update \\</span></span>
<span class="line"><span style="color:#A6ACCD;"> &amp;&amp; apt-get install -y --no-install-recommends \\</span></span>
<span class="line"><span style="color:#A6ACCD;">   libfftw3-dev \\</span></span>
<span class="line"><span style="color:#A6ACCD;">   gcc &amp;&amp; apt-get clean \\</span></span>
<span class="line"><span style="color:#A6ACCD;"> &amp;&amp; rm -rf /var/lib/apt/lists/*</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> apt update</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> apt-get install -y curl</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> apt-get -y install libcurl4-openssl-dev </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#676E95;"># install R packages required </span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> R -e </span><span style="color:#C3E88D;">&#39;install.packages(c(&quot;DBI&quot;,&quot;tidyverse&quot;, &quot;shiny&quot;, &quot;plotly&quot;,&quot;googleCloudStorageR&quot;,&quot;shinyWidgets&quot;,&quot;BiocManager&quot;), \\</span></span>
<span class="line"><span style="color:#C3E88D;">            repos=&quot;https://packagemanager.rstudio.com/cran/__linux__/focal/2021-04-23&quot;\\</span></span>
<span class="line"><span style="color:#C3E88D;">          )&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> R -e </span><span style="color:#C3E88D;">&quot;install.packages(&#39;RMySQL&#39;, repos=&#39;http://cran.rstudio.com/&#39;, version=&#39;0.10.21&#39;, dependencies=TRUE)&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> R -e </span><span style="color:#C3E88D;">&quot;install.packages(&#39;jpeg&#39;, dependencies=TRUE)&quot;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># install required R libraries https://stackoverflow.com/questions/70991621/installing-r-package-decipher-in-a-docker-image https://gist.github.com/zoevanhavre/ed78a14db3a8763e15457f04764b40e6</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> Rscript -e </span><span style="color:#C3E88D;">&#39;requireNamespace(&quot;BiocManager&quot;); BiocManager::install();&#39;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">&amp;&amp; Rscript -e </span><span style="color:#C3E88D;">&#39;requireNamespace(&quot;BiocManager&quot;); BiocManager::install(&quot;EBImage&quot;)&#39;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># copy the app directory into the image</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">COPY</span><span style="color:#A6ACCD;"> ./shiny-app/* /srv/shiny-server/</span></span>
<span class="line"><span style="color:#676E95;"># 给该文件放开最大权限</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> chmod -R 777 /srv/shiny-server</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#A6ACCD;"> chmod -R 777 /srv</span></span>
<span class="line"><span style="color:#676E95;"># RUN mkdir -p /srv/shiny-server/tmpdata</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># run app</span></span>
<span class="line"><span style="color:#F78C6C;">CMD</span><span style="color:#A6ACCD;"> [</span><span style="color:#C3E88D;">&quot;/usr/bin/shiny-server&quot;</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"></span></code></pre></div><p>ui.r</p><div class="language-r"><button title="Copy Code" class="copy"></button><span class="lang">r</span><pre class="shiki"><code><span class="line"><span style="color:#82AAFF;">library</span><span style="color:#A6ACCD;">(EBImage)</span></span>
<span class="line"><span style="color:#82AAFF;">library</span><span style="color:#A6ACCD;">(shiny)</span></span>
<span class="line"><span style="color:#82AAFF;">library</span><span style="color:#A6ACCD;">(jpeg)</span></span>
<span class="line"><span style="color:#A6ACCD;">shinyUI</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">navbarPage</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Image Processing</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">               </span></span>
<span class="line"><span style="color:#82AAFF;">                   </span></span>
<span class="line"><span style="color:#82AAFF;">                   </span></span>
<span class="line"><span style="color:#82AAFF;">                   </span><span style="color:#A6ACCD;">tabPanel</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Image Filtering</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                            </span><span style="color:#A6ACCD;">fluidPage</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">                              </span><span style="color:#A6ACCD;">sidebarLayout</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">                                 </span><span style="color:#A6ACCD;">position</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">right</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                                </span><span style="color:#A6ACCD;">sidebarPanel</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">                                  </span><span style="color:#A6ACCD;">textInput</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">url</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">label</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">h6</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Enter Image URL</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#82AAFF;">                                  </span></span>
<span class="line"><span style="color:#82AAFF;">                                  </span><span style="color:#A6ACCD;">sliderInput</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">lps</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">label</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">h6</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Low-Pass Filter size</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">),</span><span style="color:#A6ACCD;">min</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">max</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">50</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">21</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#82AAFF;">                                  </span><span style="color:#A6ACCD;">sliderInput</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hps</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">label</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">h6</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">High-Pass Filter size</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">),</span><span style="color:#A6ACCD;">min</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">max</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#82AAFF;">                                  </span><span style="color:#A6ACCD;">checkboxGroupInput</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">filt</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">label</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">h6</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Filter Type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">choices</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#C792EA;">list</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Low-Pass Filter</span><span style="color:#89DDFF;">&quot;</span><span style="color:#82AAFF;"> = </span><span style="color:#F78C6C;">1</span><span style="color:#82AAFF;">, </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">High-Pass Filter</span><span style="color:#89DDFF;">&quot;</span><span style="color:#82AAFF;"> = </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">)),</span><span style="color:#82AAFF;">              </span></span>
<span class="line"><span style="color:#82AAFF;">                                  </span><span style="color:#A6ACCD;">checkboxGroupInput</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Save1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">label</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">h6</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">choices</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#C792EA;">list</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Save</span><span style="color:#89DDFF;">&quot;</span><span style="color:#82AAFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#82AAFF;">                                </span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#82AAFF;">                                </span></span>
<span class="line"><span style="color:#82AAFF;">                                </span><span style="color:#A6ACCD;">mainPanel</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">                                  </span><span style="color:#A6ACCD;">imageOutput</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">img3</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">                                </span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#82AAFF;">                            </span><span style="color:#89DDFF;">)),</span></span>
<span class="line"><span style="color:#82AAFF;">                   </span></span>
<span class="line"><span style="color:#82AAFF;">                   </span><span style="color:#A6ACCD;">tabPanel</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Morphing</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                            </span><span style="color:#A6ACCD;">fluidPage</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">                              </span><span style="color:#A6ACCD;">sidebarLayout</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">                                </span><span style="color:#A6ACCD;">position</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">right</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                                </span><span style="color:#A6ACCD;">sidebarPanel</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">                                  </span><span style="color:#A6ACCD;">sliderInput</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">mm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">label</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">h6</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Magnitude</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">),</span><span style="color:#A6ACCD;">min</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">max</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">50</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">21</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;">                              </span></span>
<span class="line"><span style="color:#82AAFF;">                                  </span><span style="color:#A6ACCD;">checkboxGroupInput</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">morph</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">label</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">h6</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Morphological Operators</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">choices</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#C792EA;">list</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Erode</span><span style="color:#89DDFF;">&quot;</span><span style="color:#82AAFF;"> = </span><span style="color:#F78C6C;">1</span><span style="color:#82AAFF;">, </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Dilate</span><span style="color:#89DDFF;">&quot;</span><span style="color:#82AAFF;"> = </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">)),</span><span style="color:#82AAFF;">              </span></span>
<span class="line"><span style="color:#82AAFF;">                                  </span><span style="color:#A6ACCD;">checkboxGroupInput</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Save2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">label</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">h6</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">choices</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#C792EA;">list</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Save</span><span style="color:#89DDFF;">&quot;</span><span style="color:#82AAFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#82AAFF;">                                </span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#82AAFF;">                                </span></span>
<span class="line"><span style="color:#82AAFF;">                                </span><span style="color:#A6ACCD;">mainPanel</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">                                  </span><span style="color:#A6ACCD;">imageOutput</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">img4</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">                                </span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#82AAFF;">                            </span><span style="color:#89DDFF;">))</span><span style="color:#82AAFF;">                 </span></span>
<span class="line"><span style="color:#89DDFF;">))</span></span>
<span class="line"></span></code></pre></div><p>server.r</p><div class="language-r"><button title="Copy Code" class="copy"></button><span class="lang">r</span><pre class="shiki"><code><span class="line"></span>
<span class="line"><span style="color:#82AAFF;">library</span><span style="color:#A6ACCD;">(EBImage)</span></span>
<span class="line"><span style="color:#82AAFF;">library</span><span style="color:#A6ACCD;">(shiny)</span></span>
<span class="line"><span style="color:#82AAFF;">library</span><span style="color:#A6ACCD;">(jpeg)</span></span>
<span class="line"><span style="color:#A6ACCD;">shinyServer</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">input</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">output</span><span style="color:#89DDFF;">)</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#82AAFF;">  </span></span>
<span class="line"><span style="color:#82AAFF;">  </span><span style="color:#A6ACCD;">output</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">text</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">renderText</span><span style="color:#89DDFF;">({</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># web image</span></span>
<span class="line"><span style="color:#82AAFF;">    download.file(</span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">url</span><span style="color:#82AAFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.jpeg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#82AAFF;">,</span><span style="color:#A6ACCD;">mode</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">wb</span><span style="color:#89DDFF;">&quot;</span><span style="color:#82AAFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">#native image</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;">img</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">readImage</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;">writeImage</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">img</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">img.jpeg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">quality</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Image:</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#82AAFF;">  </span><span style="color:#89DDFF;">})</span></span>
<span class="line"><span style="color:#82AAFF;">  </span></span>
<span class="line"><span style="color:#82AAFF;">   </span></span>
<span class="line"><span style="color:#82AAFF;">  </span></span>
<span class="line"><span style="color:#82AAFF;">   </span></span>
<span class="line"><span style="color:#82AAFF;">  </span></span>
<span class="line"><span style="color:#82AAFF;">  </span><span style="color:#A6ACCD;">output</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">img3</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">renderImage</span><span style="color:#89DDFF;">({</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;">oi2</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">readImage</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">if</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">lps</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#82AAFF;">      </span><span style="color:#89DDFF;">if</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">lps</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">%%</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">2</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">==</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">0</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;">lps</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">lps</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">+</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#82AAFF;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">      </span><span style="color:#89DDFF;">else</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;">lps</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">lps</span></span>
<span class="line"><span style="color:#82AAFF;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">else</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#82AAFF;">      </span><span style="color:#A6ACCD;">lps</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">lps</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">    </span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;">flo</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">makeBrush</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">lps</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">shape</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">disc</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">step</span><span style="color:#89DDFF;">=FALSE)^</span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;">flo</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">flo</span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;">sum(</span><span style="color:#A6ACCD;">flo</span><span style="color:#82AAFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;">fhi</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> matrix(</span><span style="color:#F78C6C;">1</span><span style="color:#82AAFF;">, </span><span style="color:#A6ACCD;">nc</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3</span><span style="color:#82AAFF;">, </span><span style="color:#A6ACCD;">nr</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3</span><span style="color:#82AAFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;">fhi</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">2</span><span style="color:#82AAFF;">,</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">]</span><span style="color:#82AAFF;"> = </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">hps</span></span>
<span class="line"><span style="color:#82AAFF;">    </span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">if</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">is.null(</span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">filt</span><span style="color:#89DDFF;">)</span><span style="color:#82AAFF;">)</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#82AAFF;">      </span><span style="color:#A6ACCD;">oi2</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">oi2</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">else</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">if</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">filt</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">==</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#82AAFF;">      </span><span style="color:#A6ACCD;">oi2</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">filter2</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">oi2</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">flo</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">else</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">if</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">filt</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">==</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#82AAFF;">      </span><span style="color:#A6ACCD;">oi2</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">filter2</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">oi2</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">fhi</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">    </span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">if</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">is.null(</span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">Save1</span><span style="color:#89DDFF;">)</span><span style="color:#82AAFF;">)</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#82AAFF;">      </span><span style="color:#A6ACCD;">oi2</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">oi2</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">else</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#82AAFF;">      </span><span style="color:#A6ACCD;">writeImage</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">oi2</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">img.jpeg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">quality</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">   </span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;">writeImage</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">oi2</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">img2.jpeg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">quality</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;">filename</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> normalizePath(file.path(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./</span><span style="color:#89DDFF;">&#39;</span><span style="color:#82AAFF;">,paste0(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">img2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#82AAFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.jpeg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#82AAFF;">)))</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#C792EA;">list</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">src</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">filename</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">  </span><span style="color:#89DDFF;">},</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">deleteFile</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">FALSE)</span></span>
<span class="line"><span style="color:#82AAFF;">  </span></span>
<span class="line"><span style="color:#82AAFF;">  </span><span style="color:#A6ACCD;">output</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">img4</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">renderImage</span><span style="color:#89DDFF;">({</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;">oi2</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">readImage</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">   </span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">if</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">mm</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#82AAFF;">      </span><span style="color:#89DDFF;">if</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">mm</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">%%</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">2</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">==</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">0</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;">mm</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">mm</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">+</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#82AAFF;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">      </span><span style="color:#89DDFF;">else</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;">mm</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">mm</span></span>
<span class="line"><span style="color:#82AAFF;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">else</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#82AAFF;">      </span><span style="color:#A6ACCD;">mm</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">mm</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">    </span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;">kern</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">makeBrush</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">mm</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">shape</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">diamond</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)^</span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#82AAFF;">    </span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">if</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">is.null(</span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">morph</span><span style="color:#89DDFF;">)</span><span style="color:#82AAFF;">)</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#82AAFF;">      </span><span style="color:#A6ACCD;">oi2</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">oi2</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">else</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">if</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">morph</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">==</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#82AAFF;">      </span><span style="color:#A6ACCD;">oi2</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;">  </span><span style="color:#A6ACCD;">erode</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">oi2</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">kern</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">else</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">if</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">morph</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">==</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#82AAFF;">      </span><span style="color:#A6ACCD;">oi2</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">dilate</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">oi2</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">kern</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">    </span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">if</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">is.null(</span><span style="color:#A6ACCD;">input</span><span style="color:#F78C6C;">$</span><span style="color:#A6ACCD;">Save1</span><span style="color:#89DDFF;">)</span><span style="color:#82AAFF;">)</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#82AAFF;">      </span><span style="color:#A6ACCD;">oi2</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">oi2</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">else</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#82AAFF;">      </span><span style="color:#A6ACCD;">writeImage</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">oi2</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">img.jpeg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">quality</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">  </span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;">writeImage</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">oi2</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">img2.jpeg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">quality</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;">filename</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&lt;-</span><span style="color:#82AAFF;"> normalizePath(file.path(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./</span><span style="color:#89DDFF;">&#39;</span><span style="color:#82AAFF;">,paste0(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">img2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#82AAFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.jpeg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#82AAFF;">)))</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#C792EA;">list</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">src</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">filename</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">  </span><span style="color:#89DDFF;">},</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">deleteFile</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">FALSE)</span></span>
<span class="line"><span style="color:#82AAFF;">  </span></span>
<span class="line"><span style="color:#82AAFF;">  </span></span>
<span class="line"><span style="color:#89DDFF;">})</span></span>
<span class="line"></span></code></pre></div>`,52),A=[y];function D(C,i,u,d,h,g){return n(),a("div",null,A)}const b=s(F,[["render",D]]);export{q as __pageData,b as default};
