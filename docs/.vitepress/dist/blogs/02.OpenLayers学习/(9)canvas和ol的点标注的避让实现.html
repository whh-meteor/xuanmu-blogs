<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基于canvas和ol的点标注的避让实现 | 旋木-Blogs</title>
    <meta name="description" content="WebGIS开发从入门到进阶，这里都有">
    <link rel="stylesheet" href="/xuanmu-blogs/assets/style.152ea67f.css">
    <link rel="modulepreload" href="/xuanmu-blogs/assets/chunks/VPAlgoliaSearchBox.0dd894a7.js">
    <link rel="modulepreload" href="/xuanmu-blogs/assets/app.2a13895e.js">
    <link rel="modulepreload" href="/xuanmu-blogs/assets/blogs_02.OpenLayers学习_(9)canvas和ol的点标注的避让实现.md.2e9286ea.lean.js">
    
    <link rel="icon" href="/木马1.png">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-f44a984a><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-f44a984a data-v-8c0a9870><div class="VPNavBar has-sidebar" data-v-8c0a9870 data-v-1bbed88e><div class="container" data-v-1bbed88e><div class="VPNavBarTitle has-sidebar" data-v-1bbed88e data-v-d5925166><a class="title" href="/xuanmu-blogs/" data-v-d5925166><!--[--><!--]--><!--[--><img class="VPImage logo" src="/xuanmu-blogs/木马1.png" alt data-v-b7ac6bd3><!--]--><!--[-->旋木 Blog<!--]--><!--[--><!--]--></a></div><div class="content" data-v-1bbed88e><!--[--><!--]--><div class="VPNavBarSearch search" data-v-1bbed88e style="--5943dbe8:&#39;Meta&#39;;"><div id="docsearch"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-1bbed88e data-v-f83db6ba><span id="main-nav-aria-label" class="visually-hidden" data-v-f83db6ba>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/xuanmu-blogs/blogs/" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->博客<!--]--><!----></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 友情链接 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="https://blog.csdn.net/" target="_blank" rel="noreferrer" data-v-e8e0fb1d data-v-3c355974><!--[-->CSDN<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-3c355974><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="https://gitee.com/martleth/xuanmu-blogs/pages" target="_blank" rel="noreferrer" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->Gitee<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-1bbed88e data-v-a3e7452b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-a3e7452b data-v-481098f9 data-v-eba7420e><span class="check" data-v-eba7420e><span class="icon" data-v-eba7420e><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-481098f9><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-481098f9><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-1bbed88e data-v-738bef5a data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://gitee.com/martleth/xuanmu-blogs/" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg t="1671270414569" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2135" width="64" height="64"><path d="M512 0c282.784 0 512 229.216 512 512s-229.216 512-512 512S0 794.784 0 512 229.216 0 512 0z m189.952 752l11.2-108.224c-31.904 9.536-100.928 16.128-147.712 16.128-134.464 0-205.728-47.296-195.328-146.304 11.584-110.688 113.152-145.696 232.64-145.696 54.784 0 122.432 8.8 151.296 18.336L768 272.704C724.544 262.24 678.272 256 599.584 256c-203.2 0-388.704 94.88-406.4 263.488C178.336 660.96 303.584 768 535.616 768c80.672 0 138.464-6.432 166.336-16z" fill="#CE000D" p-id="2136"></path></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-1bbed88e data-v-e4361c82 data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6ffb57d3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-6ffb57d3><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><!----><!--[--><!--[--><!----><div class="group" data-v-e4361c82><div class="item appearance" data-v-e4361c82><p class="label" data-v-e4361c82>Appearance</p><div class="appearance-action" data-v-e4361c82><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-e4361c82 data-v-481098f9 data-v-eba7420e><span class="check" data-v-eba7420e><span class="icon" data-v-eba7420e><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-481098f9><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-481098f9><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-e4361c82><div class="item social-links" data-v-e4361c82><div class="VPSocialLinks social-links-list" data-v-e4361c82 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://gitee.com/martleth/xuanmu-blogs/" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg t="1671270414569" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2135" width="64" height="64"><path d="M512 0c282.784 0 512 229.216 512 512s-229.216 512-512 512S0 794.784 0 512 229.216 0 512 0z m189.952 752l11.2-108.224c-31.904 9.536-100.928 16.128-147.712 16.128-134.464 0-205.728-47.296-195.328-146.304 11.584-110.688 113.152-145.696 232.64-145.696 54.784 0 122.432 8.8 151.296 18.336L768 272.704C724.544 262.24 678.272 256 599.584 256c-203.2 0-388.704 94.88-406.4 263.488C178.336 660.96 303.584 768 535.616 768c80.672 0 138.464-6.432 166.336-16z" fill="#CE000D" p-id="2136"></path></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-1bbed88e data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-f44a984a data-v-b6162a8b><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-b6162a8b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-b6162a8b><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-b6162a8b>Menu</span></button><a class="top-link" href="#" data-v-b6162a8b> Return to top </a></div><aside class="VPSidebar" data-v-f44a984a data-v-a186aa16><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-a186aa16><span class="visually-hidden" id="sidebar-aria-label" data-v-a186aa16> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>资源分享</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/xuanmu-blogs/blogs/01.%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB/(1)%E5%9C%B0%E7%90%83%E7%A7%91%E5%AD%A6%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88%E8%B5%84%E6%BA%90%E6%A3%80%E7%B4%A2%EF%BC%89.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>1 地球科学数据库（资源检索）</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/xuanmu-blogs/blogs/01.%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB/(2)%E5%9B%BD%E5%86%85%E5%A4%96%E9%81%A5%E6%84%9F%E5%BD%B1%E5%83%8F%E4%B8%8B%E8%BD%BD.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>2 国内外遥感影像下载</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/xuanmu-blogs/blogs/01.%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB/(3)Python%E9%81%8D%E5%8E%86%E8%AE%A1%E7%AE%97%E6%B3%A2%E6%AE%B5.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>3 Python遍历计算波段</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>Open Layers学习</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/xuanmu-blogs/blogs/02.OpenLayers%E5%AD%A6%E4%B9%A0/(1)%E5%AE%9E%E7%8E%B0%E8%81%9A%E5%90%88%E6%A0%87%E8%AE%B0%EF%BC%8C%E7%82%B9%E5%87%BB%E5%BC%B9%E5%87%BA%E4%BF%A1%E6%81%AF.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>1 实现聚合标记，点击弹出信息</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/xuanmu-blogs/blogs/02.OpenLayers%E5%AD%A6%E4%B9%A0/(2)%E7%83%AD%E5%8A%9B%E5%9B%BEheatmap.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>2 热力图heatmap</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/xuanmu-blogs/blogs/02.OpenLayers%E5%AD%A6%E4%B9%A0/(3)iClient%20%E8%81%9A%E5%90%88%E6%A0%87%E7%AD%BE%E4%B8%93%E9%A2%98%E5%9B%BE.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>3 I Client 聚合标签专题图</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/xuanmu-blogs/blogs/02.OpenLayers%E5%AD%A6%E4%B9%A0/(4)%E5%90%8C%E4%B8%80%E5%9B%BE%E5%B1%82%E8%AE%BE%E7%BD%AE%E4%B8%8D%E5%90%8C%E7%9A%84%E7%82%B9%E7%AC%A6%E5%8F%B7.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>4 同一图层设置不同的点符号</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/xuanmu-blogs/blogs/02.OpenLayers%E5%AD%A6%E4%B9%A0/(5)%E7%9F%A2%E9%87%8F%E6%A0%B7%E5%BC%8F%E7%BC%96%E8%BE%91%E5%99%A8.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>5 矢量样式编辑器</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/xuanmu-blogs/blogs/02.OpenLayers%E5%AD%A6%E4%B9%A0/(6)%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2%20%E7%82%B9%E5%87%BB%E5%AE%9A%E4%BD%8D.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>6 模糊查询 点击定位</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/xuanmu-blogs/blogs/02.OpenLayers%E5%AD%A6%E4%B9%A0/(7)%E7%BC%93%E5%86%B2%E5%8C%BA%E7%9A%84%E7%A9%BA%E9%97%B4%E7%9B%B8%E4%BA%A4%E5%88%86%E6%9E%90.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>7 缓冲区的空间相交分析</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/xuanmu-blogs/blogs/02.OpenLayers%E5%AD%A6%E4%B9%A0/(8)Ol+Vue-cli.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>8 Ol Vue Cli</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link active" href="/xuanmu-blogs/blogs/02.OpenLayers%E5%AD%A6%E4%B9%A0/(9)canvas%E5%92%8Col%E7%9A%84%E7%82%B9%E6%A0%87%E6%B3%A8%E7%9A%84%E9%81%BF%E8%AE%A9%E5%AE%9E%E7%8E%B0.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>9 Canvas和ol的点标注的避让实现</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>CSS样式</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/xuanmu-blogs/blogs/03.CSS%E6%A0%B7%E5%BC%8F/(1)CSS+Vue%E9%A1%B5%E9%9D%A2%E5%8A%A0%E8%BD%BD%E8%BF%9B%E5%BA%A6%E6%9D%A1.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>1 CSS Vue页面加载进度条</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/xuanmu-blogs/blogs/03.CSS%E6%A0%B7%E5%BC%8F/(2)%E8%A7%86%E5%B7%AE.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>2 视差</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/xuanmu-blogs/blogs/03.CSS%E6%A0%B7%E5%BC%8F/(3)CSS%E6%B3%A2%E6%B5%AA%E9%A1%B5%E8%84%9A.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>3 CSS波浪页脚</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>Web GIS基础</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/xuanmu-blogs/blogs/04.WebGIS%E5%9F%BA%E7%A1%80/(1)WebGIS%E5%9F%BA%E7%A1%80.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>1 Web GIS基础</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/xuanmu-blogs/blogs/04.WebGIS%E5%9F%BA%E7%A1%80/(2)%E7%BB%84%E4%BB%B6%E5%BC%95%E5%85%A5.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>2 组件引入</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>ILCS系列</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/xuanmu-blogs/blogs/05.ILCS%E7%B3%BB%E5%88%97/(1)%E5%8F%91%E5%B8%83%E4%B8%80%E4%B8%AAmatlab%E7%AE%97%E6%B3%95%E6%9C%8D%E5%8A%A1.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>1 发布一个matlab算法服务</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>Docker</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/xuanmu-blogs/blogs/06.Docker/NDVI%E7%AE%97%E6%B3%95%E5%B0%81%E8%A3%85.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>NDVI算法封装</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-a186aa16><section class="VPSidebarGroup collapsible" data-v-a186aa16 data-v-6e45c352><div class="title" role="button" data-v-6e45c352><h2 class="title-text" data-v-6e45c352>GEE</h2><div class="action" data-v-6e45c352><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-6e45c352><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-6e45c352><!--[--><!--[--><a class="VPLink link link" href="/xuanmu-blogs/blogs/07.GEE/Geemap%E5%AE%89%E8%A3%85.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Geemap安装</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/xuanmu-blogs/blogs/07.GEE/Python%E9%83%A8%E7%BD%B2%E4%B8%80%E4%B8%AAGEE%E5%BA%94%E7%94%A8.html" style="padding-left:0px;" data-v-36b976d1 data-v-3c355974><!--[--><span class="link-text" data-v-36b976d1>Python部署一个 GEE应用</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-f44a984a data-v-d981fe29><div class="VPDoc has-sidebar has-aside" data-v-d981fe29 data-v-cfb513e0><div class="container" data-v-cfb513e0><div class="aside" data-v-cfb513e0><div class="aside-curtain" data-v-cfb513e0></div><div class="aside-container" data-v-cfb513e0><div class="aside-content" data-v-cfb513e0><div class="VPDocAside" data-v-cfb513e0 data-v-afc4c1a1><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-afc4c1a1 data-v-2865c0b0><div class="content" data-v-2865c0b0><div class="outline-marker" data-v-2865c0b0></div><div class="outline-title" data-v-2865c0b0>章节导航</div><nav aria-labelledby="doc-outline-aria-label" data-v-2865c0b0><span class="visually-hidden" id="doc-outline-aria-label" data-v-2865c0b0> Table of Contents for current page </span><ul class="root" data-v-2865c0b0 data-v-1188541a><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-afc4c1a1></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-cfb513e0><div class="content-container" data-v-cfb513e0><!--[--><!--]--><main class="main" data-v-cfb513e0><div style="position:relative;" class="vp-doc _xuanmu-blogs_blogs_02_OpenLayers%E5%AD%A6%E4%B9%A0_(9)canvas%E5%92%8Col%E7%9A%84%E7%82%B9%E6%A0%87%E6%B3%A8%E7%9A%84%E9%81%BF%E8%AE%A9%E5%AE%9E%E7%8E%B0" data-v-cfb513e0><div><h1 id="基于canvas和ol的点标注的避让实现" tabindex="-1">基于canvas和ol的点标注的避让实现 <a class="header-anchor" href="#基于canvas和ol的点标注的避让实现" aria-hidden="true">#</a></h1><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-hidden="true">#</a></h2><p>在做地图的时候，点的标注展示是一个非常常见的功能，但是实际中点在某些区域比较密集是非常常见的，但是业务表达中却需要将之展示出来。基于此需求，本文结合canvas和ol做一简单的实现。</p><h2 id="效果" tabindex="-1">效果 <a class="header-anchor" href="#效果" aria-hidden="true">#</a></h2><p><img src="/xuanmu-blogs/assets/img-2023-01-05-00-12-26.2f328560.png" alt=""></p><p><img src="/xuanmu-blogs/assets/img-2023-01-05-00-12-48.eb0efd12.png" alt=""></p><h2 id="实现" tabindex="-1">实现 <a class="header-anchor" href="#实现" aria-hidden="true">#</a></h2><p>1.密集区点的标注通过牵引线的方式引出展示； 2.地图放大的时候更新展示；</p><h2 id="思路" tabindex="-1">思路 <a class="header-anchor" href="#思路" aria-hidden="true">#</a></h2><p><img src="/xuanmu-blogs/assets/img-2023-01-05-00-13-36.e2dd7314.png" alt=""></p><h2 id="实现代码" tabindex="-1">实现代码 <a class="header-anchor" href="#实现代码" aria-hidden="true">#</a></h2><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const points = [</span></span>
<span class="line"><span style="color:#A6ACCD;"> { &quot;properties&quot;: {&quot;name&quot;:&quot;测试名称应该&quot;}, &quot;geometry&quot;: { &quot;type&quot;: &quot;Point&quot;, &quot;coordinates&quot;: [ 110.15558, 19.91038 ] } },</span></span>
<span class="line"><span style="color:#A6ACCD;"> { &quot;properties&quot;: {&quot;name&quot;:&quot;测试名称应&quot;}, &quot;geometry&quot;: { &quot;type&quot;: &quot;Point&quot;, &quot;coordinates&quot;: [ 113.52309, 22.21177 ] } },</span></span>
<span class="line"><span style="color:#A6ACCD;"> { &quot;properties&quot;: {&quot;name&quot;:&quot;测试名称应该&quot;}, &quot;geometry&quot;: { &quot;type&quot;: &quot;Point&quot;, &quot;coordinates&quot;: [ 114.23454, 22.21177 ] } },</span></span>
<span class="line"><span style="color:#A6ACCD;"> { &quot;properties&quot;: {&quot;name&quot;:&quot;测该很长&quot;}, &quot;geometry&quot;: { &quot;type&quot;: &quot;Point&quot;, &quot;coordinates&quot;: [ 119.35695, 26.06293 ] } },</span></span>
<span class="line"><span style="color:#A6ACCD;"> { &quot;properties&quot;: {&quot;name&quot;:&quot;测试名称应该称应该&quot;}, &quot;geometry&quot;: { &quot;type&quot;: &quot;Point&quot;, &quot;coordinates&quot;: [ 120.11582, 30.07927 ] } },</span></span>
<span class="line"><span style="color:#A6ACCD;"> { &quot;properties&quot;: {&quot;name&quot;:&quot;测试名称应&quot;}, &quot;geometry&quot;: { &quot;type&quot;: &quot;Point&quot;, &quot;coordinates&quot;: [ 121.49129, 31.14058 ] } },</span></span>
<span class="line"><span style="color:#A6ACCD;"> { &quot;properties&quot;: {&quot;name&quot;:&quot;测试名称应该&quot;}, &quot;geometry&quot;: { &quot;type&quot;: &quot;Point&quot;, &quot;coordinates&quot;: [ 117.03289, 23.5228 ] } }</span></span>
<span class="line"><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">let canvasFunction = function (extent, resolution, pixelRatio, size, projection) {</span></span>
<span class="line"><span style="color:#A6ACCD;"> const canvasWidth = size[0]</span></span>
<span class="line"><span style="color:#A6ACCD;"> const canvasHeight = size[1]</span></span>
<span class="line"><span style="color:#A6ACCD;"> const [w, h] = map.getSize()</span></span>
<span class="line"><span style="color:#A6ACCD;"> const xoff = canvasWidth - w,</span></span>
<span class="line"><span style="color:#A6ACCD;">   yoff = canvasHeight - h</span></span>
<span class="line"><span style="color:#A6ACCD;"> const canvas = document.createElement(&#39;canvas&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;"> canvas.width = canvasWidth</span></span>
<span class="line"><span style="color:#A6ACCD;"> canvas.height = canvasHeight</span></span>
<span class="line"><span style="color:#A6ACCD;"> const context = canvas.getContext(&#39;2d&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;"> // 数据聚类处理，根据上下和左右的距离进行判断</span></span>
<span class="line"><span style="color:#A6ACCD;"> function clusterData(data) {</span></span>
<span class="line"><span style="color:#A6ACCD;">   let res = {}</span></span>
<span class="line"><span style="color:#A6ACCD;">   let clusterTest = function (pixel, tolrance = [200, 30]) {</span></span>
<span class="line"><span style="color:#A6ACCD;">     let r = pixel.join(&#39;,&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">     const [x, y] = pixel</span></span>
<span class="line"><span style="color:#A6ACCD;">     for (let key in res) {</span></span>
<span class="line"><span style="color:#A6ACCD;">       const [_x, _y] = key.split(&#39;,&#39;).map(Number)</span></span>
<span class="line"><span style="color:#A6ACCD;">       const dx = Math.abs(x - _x),</span></span>
<span class="line"><span style="color:#A6ACCD;">         dy = Math.abs(y - _y)</span></span>
<span class="line"><span style="color:#A6ACCD;">       if(dx &lt; tolrance[0] &amp;&amp; dy &lt; tolrance[1]) {</span></span>
<span class="line"><span style="color:#A6ACCD;">         r = key</span></span>
<span class="line"><span style="color:#A6ACCD;">         break</span></span>
<span class="line"><span style="color:#A6ACCD;">       }</span></span>
<span class="line"><span style="color:#A6ACCD;">     }</span></span>
<span class="line"><span style="color:#A6ACCD;">     return r</span></span>
<span class="line"><span style="color:#A6ACCD;">   }</span></span>
<span class="line"><span style="color:#A6ACCD;">   for (let i = 0; i &lt; data.length; i++) {</span></span>
<span class="line"><span style="color:#A6ACCD;">     const d = data[i]</span></span>
<span class="line"><span style="color:#A6ACCD;">     const coords = ol.proj.fromLonLat(d.geometry.coordinates)</span></span>
<span class="line"><span style="color:#A6ACCD;">     let pixel = map.getPixelFromCoordinate(coords)</span></span>
<span class="line"><span style="color:#A6ACCD;">     pixel = [pixel[0]  + xoff / 2, pixel[1] + yoff / 2].map(p =&gt; Math.round(p))</span></span>
<span class="line"><span style="color:#A6ACCD;">     d.pixel = pixel</span></span>
<span class="line"><span style="color:#A6ACCD;">     let key = pixel.join(&#39;,&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">     const width = 26 * 2 + 6 + context.measureText(d.properties.name).width</span></span>
<span class="line"><span style="color:#A6ACCD;">     key = clusterTest(pixel, [width, 30])</span></span>
<span class="line"><span style="color:#A6ACCD;">     if(!res[key]) res[key] = []</span></span>
<span class="line"><span style="color:#A6ACCD;">     res[key].push(d)</span></span>
<span class="line"><span style="color:#A6ACCD;">   }</span></span>
<span class="line"><span style="color:#A6ACCD;">   return res</span></span>
<span class="line"><span style="color:#A6ACCD;"> }</span></span>
<span class="line"><span style="color:#A6ACCD;"> // 绘制两边为圆的矩形</span></span>
<span class="line"><span style="color:#A6ACCD;"> function drawRoundRect (ctx, x, y, width, height = 24, fillStyle = &#39;rgba(14,77,137,0.75)&#39;) {</span></span>
<span class="line"><span style="color:#A6ACCD;">   const r = height / 2</span></span>
<span class="line"><span style="color:#A6ACCD;">   ctx.fillStyle = fillStyle</span></span>
<span class="line"><span style="color:#A6ACCD;">   ctx.beginPath()</span></span>
<span class="line"><span style="color:#A6ACCD;">   ctx.moveTo(x + r, y)</span></span>
<span class="line"><span style="color:#A6ACCD;">   ctx.lineTo(x + width - r, y)</span></span>
<span class="line"><span style="color:#A6ACCD;">   ctx.arc(x + width - r, y + r, r, Math.PI * 1.5, Math.PI * 0.5)</span></span>
<span class="line"><span style="color:#A6ACCD;">   ctx.lineTo(x + r, y + height)</span></span>
<span class="line"><span style="color:#A6ACCD;">   ctx.arc(x + r, y + height - r, r, Math.PI * 0.5, Math.PI * 1.5)</span></span>
<span class="line"><span style="color:#A6ACCD;">   ctx.closePath()</span></span>
<span class="line"><span style="color:#A6ACCD;">   ctx.fill()</span></span>
<span class="line"><span style="color:#A6ACCD;"> }</span></span>
<span class="line"><span style="color:#A6ACCD;"> // 绘制feature</span></span>
<span class="line"><span style="color:#A6ACCD;"> function drawFeature (ctx, x = 10, y = 10, text, notCluster = true, index = 0) {</span></span>
<span class="line"><span style="color:#A6ACCD;">   let height = 26, width = height * 2 + 6,  r = height / 2</span></span>
<span class="line"><span style="color:#A6ACCD;">   if(notCluster) width += ctx.measureText(text).width</span></span>
<span class="line"><span style="color:#A6ACCD;">   ctx.save()</span></span>
<span class="line"><span style="color:#A6ACCD;">   // 如果有聚类，则避让绘制文字，放在前面是为了让指引线在下面</span></span>
<span class="line"><span style="color:#A6ACCD;">   if(!notCluster &amp;&amp; map.getView().getZoom() &gt; 4) {</span></span>
<span class="line"><span style="color:#A6ACCD;">     const radius = 60</span></span>
<span class="line"><span style="color:#A6ACCD;">     const ang  = (-index * 40 - 115) / 180 * Math.PI ;</span></span>
<span class="line"><span style="color:#A6ACCD;">     const cx = x + r, cy = y + height - r</span></span>
<span class="line"><span style="color:#A6ACCD;">     const px = cx + Math.sin(ang) * radius,</span></span>
<span class="line"><span style="color:#A6ACCD;">       py = cy + Math.cos(ang) * radius</span></span>
<span class="line"><span style="color:#A6ACCD;">     // 绘制牵引线</span></span>
<span class="line"><span style="color:#A6ACCD;">     ctx.beginPath()</span></span>
<span class="line"><span style="color:#A6ACCD;">     ctx.strokeStyle = &#39;rgba(14,77,137,0.75)&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">     ctx.lineWidth = 2</span></span>
<span class="line"><span style="color:#A6ACCD;">     ctx.moveTo(cx, cy)</span></span>
<span class="line"><span style="color:#A6ACCD;">     ctx.lineTo(px, py)</span></span>
<span class="line"><span style="color:#A6ACCD;">     ctx.stroke()</span></span>
<span class="line"><span style="color:#A6ACCD;">     // 绘制牵引线终点小圆圈</span></span>
<span class="line"><span style="color:#A6ACCD;">     ctx.beginPath()</span></span>
<span class="line"><span style="color:#A6ACCD;">     ctx.fillStyle = &#39;rgba(14,77,137,1)&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">     ctx.arc(px, py, 2, 0, Math.PI * 2)</span></span>
<span class="line"><span style="color:#A6ACCD;">     ctx.fill()</span></span>
<span class="line"><span style="color:#A6ACCD;">     // 绘制矩形</span></span>
<span class="line"><span style="color:#A6ACCD;">     const h = 18</span></span>
<span class="line"><span style="color:#A6ACCD;">     const w = ctx.measureText(text).width + 12</span></span>
<span class="line"><span style="color:#A6ACCD;">     drawRoundRect(ctx, px - w - 2, py - h / 2 - 1, w, h, &#39;rgba(14,77,137,0.5)&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">     // 绘制文字</span></span>
<span class="line"><span style="color:#A6ACCD;">     ctx.fillStyle = &#39;rgb(255,255,255)&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">     ctx.beginPath()</span></span>
<span class="line"><span style="color:#A6ACCD;">     ctx.textAlign = &#39;right&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">     ctx.textBaseline = &#39;middle&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">     ctx.fillText(text, px - 7, py)</span></span>
<span class="line"><span style="color:#A6ACCD;">   }</span></span>
<span class="line"><span style="color:#A6ACCD;">   // 绘制矩形</span></span>
<span class="line"><span style="color:#A6ACCD;">   drawRoundRect(ctx, x, y, width, height)</span></span>
<span class="line"><span style="color:#A6ACCD;">   // 绘制左边的图标</span></span>
<span class="line"><span style="color:#A6ACCD;">   ctx.beginPath()</span></span>
<span class="line"><span style="color:#A6ACCD;">   const radialLeft = ctx.createRadialGradient(x + r, y + height - r, 0, x + r, y + height - r, r)</span></span>
<span class="line"><span style="color:#A6ACCD;">   radialLeft.addColorStop(0, &#39;#fff&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">   radialLeft.addColorStop(1, &#39;rgba(255,255,255,0)&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">   ctx.fillStyle = radialLeft</span></span>
<span class="line"><span style="color:#A6ACCD;">   ctx.arc(x + r, y + height - r, r, 0, Math.PI * 2)</span></span>
<span class="line"><span style="color:#A6ACCD;">   ctx.fill()</span></span>
<span class="line"><span style="color:#A6ACCD;">   // 绘制右边的图标</span></span>
<span class="line"><span style="color:#A6ACCD;">   ctx.beginPath()</span></span>
<span class="line"><span style="color:#A6ACCD;">   const radialRight = ctx.createRadialGradient(x + width - r, y + r, 0, x + width - r, y + r, r)</span></span>
<span class="line"><span style="color:#A6ACCD;">   radialRight.addColorStop(0, &#39;#fff&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">   radialRight.addColorStop(1, &#39;rgba(255,255,255,0)&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">   ctx.fillStyle = radialRight</span></span>
<span class="line"><span style="color:#A6ACCD;">   ctx.arc(x + width - r, y + r, r, 0, Math.PI * 2)</span></span>
<span class="line"><span style="color:#A6ACCD;">   ctx.fill()</span></span>
<span class="line"><span style="color:#A6ACCD;">   // 如果没有聚类，则绘制文字</span></span>
<span class="line"><span style="color:#A6ACCD;">   if(notCluster) {</span></span>
<span class="line"><span style="color:#A6ACCD;">     ctx.fillStyle = &#39;#fff&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">     ctx.beginPath()</span></span>
<span class="line"><span style="color:#A6ACCD;">     ctx.textAlign = &#39;left&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">     ctx.textBaseline = &#39;middle&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">     ctx.fillText(text, x + height + 3, y + height - r)</span></span>
<span class="line"><span style="color:#A6ACCD;">   }</span></span>
<span class="line"><span style="color:#A6ACCD;">   ctx.restore()</span></span>
<span class="line"><span style="color:#A6ACCD;"> }</span></span>
<span class="line"><span style="color:#A6ACCD;"> const cluster = clusterData(points)</span></span>
<span class="line"><span style="color:#A6ACCD;"> for (let key in cluster) {</span></span>
<span class="line"><span style="color:#A6ACCD;">   const data = cluster[key]</span></span>
<span class="line"><span style="color:#A6ACCD;">   const showText = data.length === 1</span></span>
<span class="line"><span style="color:#A6ACCD;">   data.forEach((d, index) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">     const [x, y] = d.pixel</span></span>
<span class="line"><span style="color:#A6ACCD;">     drawFeature(context, x, y, d.properties.name, showText, index)</span></span>
<span class="line"><span style="color:#A6ACCD;">   })</span></span>
<span class="line"><span style="color:#A6ACCD;"> }</span></span>
<span class="line"><span style="color:#A6ACCD;"> return canvas;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">const layer = new ol.layer.Image({</span></span>
<span class="line"><span style="color:#A6ACCD;"> source: new ol.source.ImageCanvas({</span></span>
<span class="line"><span style="color:#A6ACCD;">   canvasFunction: canvasFunction</span></span>
<span class="line"><span style="color:#A6ACCD;"> })</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span>
<span class="line"><span style="color:#A6ACCD;">map.addLayer(layer);</span></span>
<span class="line"><span style="color:#A6ACCD;">script&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-cfb513e0 data-v-21f75714><!----><div class="prev-next" data-v-21f75714><div class="pager" data-v-21f75714><a class="pager-link prev" href="/xuanmu-blogs/blogs/02.OpenLayers%E5%AD%A6%E4%B9%A0/(8)Ol+Vue-cli.html" data-v-21f75714><span class="desc" data-v-21f75714>←上一篇</span><span class="title" data-v-21f75714>8 Ol Vue Cli</span></a></div><div class="has-prev pager" data-v-21f75714><a class="pager-link next" href="/xuanmu-blogs/blogs/03.CSS%E6%A0%B7%E5%BC%8F/(1)CSS+Vue%E9%A1%B5%E9%9D%A2%E5%8A%A0%E8%BD%BD%E8%BF%9B%E5%BA%A6%E6%9D%A1.html" data-v-21f75714><span class="desc" data-v-21f75714>下一篇→</span><span class="title" data-v-21f75714>1 CSS Vue页面加载进度条</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><footer class="VPFooter has-sidebar" data-v-f44a984a data-v-9f24cc86><div class="container" data-v-9f24cc86><!----><p class="copyright" data-v-9f24cc86>Copyright © 2023 xuanmu</p></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"blogs_02.openlayers学习_(2)热力图heatmap.md\":\"20010efe\",\"blogs_02.openlayers学习_(1)实现聚合标记，点击弹出信息.md\":\"e8de0951\",\"blogs_01.资源分享_(3)python遍历计算波段.md\":\"302aafe6\",\"blogs_01.资源分享_(2)国内外遥感影像下载.md\":\"42c4abf1\",\"blogs_02.openlayers学习_(4)同一图层设置不同的点符号.md\":\"34b1cd20\",\"blogs_01.资源分享_(1)地球科学数据库（资源检索）.md\":\"81a333c4\",\"blogs_02.openlayers学习_(3)iclient 聚合标签专题图.md\":\"e8feaa1b\",\"blogs_02.openlayers学习_(8)ol_vue-cli.md\":\"6b0bb6b2\",\"blogs_02.openlayers学习_(6)模糊查询 点击定位.md\":\"06222196\",\"blogs_02.openlayers学习_(5)矢量样式编辑器.md\":\"b4ef2b42\",\"blogs_04.webgis基础_(2)组件引入.md\":\"33382a3c\",\"blogs_03.css样式_(2)视差.md\":\"719a223e\",\"blogs_03.css样式_(1)css_vue页面加载进度条.md\":\"dd03af89\",\"blogs_02.openlayers学习_(7)缓冲区的空间相交分析.md\":\"1c8be9e0\",\"blogs_02.openlayers学习_(9)canvas和ol的点标注的避让实现.md\":\"2e9286ea\",\"blogs_03.css样式_(3)css波浪页脚.md\":\"113ee9cf\",\"blogs_04.webgis基础_(1)webgis基础.md\":\"a154e2f0\",\"idea_01.曲谱_(12).半城烟沙ukelele.md\":\"54985c4b\",\"blogs_06.docker_ndvi算法封装.md\":\"0c8fe70d\",\"idea_01.曲谱_(11).幻听.md\":\"7c631b56\",\"idea_01.曲谱_(1) 南山南.md\":\"e05dde02\",\"idea_02.随笔_(3)新年随记.md\":\"96ce195a\",\"blogs_07.gee_python部署一个gee应用.md\":\"8f794c7d\",\"idea_01.曲谱_(9)玫瑰花的葬礼ukelele.md\":\"d5fc78a6\",\"idea_01.曲谱_(7)如果当时ukelele.md\":\"ec679180\",\"idea_01.曲谱_(8)清明雨上ukelele.md\":\"97140803\",\"idea_01.曲谱_(6)七里香ukelele.md\":\"d4c9a908\",\"blogs_index.md\":\"16e8edec\",\"idea_02.随笔_(4)情人节独白.md\":\"c0501fd7\",\"knowledge_01.wps知识_01asd.md\":\"f6041ea3\",\"idea_02.随笔_(5)草籽.md\":\"598bcba2\",\"idea_02.随笔_(6)疫情三年.md\":\"18cb4d9b\",\"idea_03.人生观察_(4)关于婚姻.md\":\"4030b533\",\"idea_03.人生观察_(1)人生观察(交往篇).md\":\"01da9b42\",\"blogs_07.gee_geemap安装.md\":\"2d2ef7d5\",\"idea_03.人生观察_(2)人生观察(生活篇).md\":\"038e7803\",\"idea_01.曲谱_(3)匆匆那年ukulele.md\":\"466532c2\",\"idea_03.人生观察_(5)悲观理想.md\":\"61e1bb7b\",\"idea_01.曲谱_(4)大鱼ukulele.md\":\"207d95ea\",\"idea_01.曲谱_(5)忽然之间ukulele.md\":\"a4363e5f\",\"idea_02.随笔_(2)课题组合照.md\":\"4d5b2b79\",\"idea_01.曲谱_(10).庐州月ukelele.md\":\"056ae2ef\",\"idea_03.人生观察_(3)自我与社会.md\":\"5d837318\",\"index.md\":\"e8029f1a\",\"idea_01.曲谱_(2)安河桥.md\":\"3b71289d\",\"idea_index.md\":\"203fc79c\",\"idea_02.随笔_(1)论文感悟.md\":\"f8f82254\",\"knowledge_02.cet-6_(1)听力.md\":\"cf7ec171\",\"knowledge_index.md\":\"778e160b\",\"blogs_05.ilcs系列_(1)发布一个matlab算法服务.md\":\"7047f696\",\"knowledge_01.wps知识_grassgis wiki wps.md\":\"bf0c311e\"}")</script>
    <script type="module" async src="/xuanmu-blogs/assets/app.2a13895e.js"></script>
    
  </body>
</html>